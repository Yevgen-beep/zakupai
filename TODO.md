0. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–°–ø—Ä–∏–Ω—Ç 0)

\[x\] Docker Compose: db, calc-service, risk-engine, doc-service, embedding-api, billing-service
\[x\] Health-check /health, –∑–∞—â–∏—â—ë–Ω–Ω—ã–π /info (X-API-Key)
\[x\] CI: lint + build (GitHub Actions)
\[x\] Makefile: make up/down/logs/test (+ smoke-\*)
\[x\] –õ–æ–≥–∏ JSON + –∫–æ—Ä–µ–ª—è—Ü–∏—è X-Request-Id –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
\[x\] –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ scripts/bootstrap.sh
\[x\] –£–¥–∞–ª–∏—Ç—å version: –∏–∑ docker-compose.yml (warning compose)
\[x\] Reverse-proxy (nginx gateway) + rate limits (429) + prefix stripping
\[x\] Pre-commit —Ö—É–∫–∏ (ruff/black/isort, yamllint, mdformat, bandit)

1. –î–∞–Ω–Ω—ã–µ –∏ —Å—Ö–µ–º–∞ –ë–î

\[x\] –¢–∞–±–ª–∏—Ü–∞ lots(id, title, price) (–º–∏–≥—Ä–∞—Ü–∏—è V1)
\[x\] –ú–∏–≥—Ä–∞—Ü–∏—è V2: lots(risk_score numeric, deadline date, customer_bin text, plan_id text)
\[x\] –¢–∞–±–ª–∏—Ü—ã: suppliers(bin, name), prices(source, sku, price), lot_prices(lot_id, price_id, qty)
\[x\] –ò–Ω–¥–µ–∫—Å—ã –ø–æ customer_bin, deadline
\[x\] –ò–Ω–¥–µ–∫—Å—ã: prices(sku), prices(captured_at)
\[x\] –ò–Ω–¥–µ–∫—Å—ã: risk_evaluations(lot_id, created_at DESC)
\[x\] FK –ø–æ–ª–∏—Ç–∏–∫–∞: CASCADE –¥–ª—è lot_prices.(lot_id, price_id)
\[x\] Seeding: scripts/seed.sql + scripts/seed.sh
\[x\] Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)

2. –°–µ—Ä–≤–∏—Å—ã (FastAPI)

\[x\] calc-service: /calc/vat, /calc/margin, /calc/penalty + –∑–∞–ø–∏—Å—å –≤ finance_calcs
\[x\] risk-engine: /risk/score, /risk/explain/{lot_id} + –∑–∞–ø–∏—Å—å –≤ risk_evaluations
\[x\] doc-service: /tldr, /letters/generate, /render/html
\[x\] doc-service: —ç–∫—Å–ø–æ—Ä—Ç HTML‚ÜíPDF (/render/pdf)
\[x\] embedding-api: /embed, /index, /search
\[x\] doc-service: –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è ru-KZ
\[x\] Pytest + curl-–ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (n8n / Flowise)

\[x\] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–≤—è–∑–Ω–æ—Å—Ç—å: Flowise/n8n ‚Üí zakupai —Å–µ—Ä–≤–∏—Å—ã (docker networks)
\[x\] n8n-nodes: goszakup-rk
\[x\] n8n-nodes: price-aggregator
\[x\] n8n-nodes: tender-finance-calc
\[x\] n8n-nodes: lot-risk-scoring
\[x\] n8n-nodes: doc-builder
\[x\] flowise-tools: lot-reader
\[x\] flowise-tools: risk-explain
\[x\] flowise-tools: finance-calc
\[x\] flowise-tools: template-gen

4. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø–æ—Ç–æ–∫–∏

\[x\] Telegram: /start + API Key
\[x\] Telegram: /lot \<id|url> ‚Üí TL;DR ‚Üí —Ä–∏—Å–∫ ‚Üí —Ñ–∏–Ω–∫–∞–ª—å–∫ ‚Üí ¬´–î–æ–∫—É–º–µ–Ω—Ç—ã¬ª
\[x\] Telegram: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ¬´–≥–æ—Ä—è—á–∏–µ –ª–æ—Ç—ã¬ª (cron)
\[x\] –í–µ–±-–ø–∞–Ω–µ–ª—å: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ—Ç–∞ + —Ñ–æ—Ä–º–∞ –∞–ø–ª–æ–∞–¥–∞ –ø—Ä–∞–π—Å–æ–≤ (CSV/XLSX)

5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø

\[x\] –ï–¥–∏–Ω—ã–π X-API-Key (+ /info)
\[x\] Rate limits –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö (nginx gateway ‚Üí 429)
\[x\] –ê—É–¥–∏—Ç-–ª–æ–≥–∏ –≤—ã–∑–æ–≤–æ–≤
\[x\] CORS/CSRF –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è –≤–µ–±-–ø–∞–Ω–µ–ª–∏
\[x\] SAST: Bandit –≤ pre-commit/CI
\[x\] –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (FastAPI deps) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π

6. DevOps / —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è1

\[x\] Smoke –¥–ª—è calc/risk/doc/emb (—Å–∫—Ä–∏–ø—Ç + Makefile)
\[x\] –í–∫–ª—é—á–∏—Ç—å smoke-–º–∞—Ç—Ä–∏—Ü—É –≤ CI –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º
\[x\] Envs: .env.dev, .env.stage, .env.prod
\[x\] –ë—ç–∫–∞–ø—ã –ë–î (pg_dump + rclone –≤ –æ–±–ª–∞–∫–æ)
\[x\] Prometheus + Grafana, –∞–ª–µ—Ä—Ç—ã
\[x\] Docker-—Ç–µ–≥–∏ —Ä–µ–ª–∏–∑–æ–≤, compose pull && up -d

7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

\[x\] OpenAPI: /docs, /openapi.json
\[x\] README.md: –∑–∞–ø—É—Å–∫, –ø–æ—Ä—Ç—ã, curl (–±–∞–∑–æ–≤–æ)
\[x\] CHANGELOG.md
\[x\] docs/architecture.md

8. –ë–∏–∑–Ω–µ—Å/—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ

\[ \] –°–≤–µ—Ä–∫–∞ ¬´—Å–µ—Ä–≤–∏—Å—ã/–±–æ–ª–∏¬ª —Å –±—ç–∫–ª–æ–≥–æ–º
\[ \] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏/–û–ö–≠–î –¥–ª—è –¢–û–û (Astana Hub)
\[ \] –í—ã–∂–∏–º–∫–∞ –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω–∞ ‚Üí –ª–µ–Ω–¥–∏–Ω–≥/–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è

9. Billing Service (MVP)

\[x\] billing-service: POST /billing/create_key, /validate_key, /usage
\[x\] PostgreSQL billing —Å—Ö–µ–º–∞: users, api_keys, usage, payments
\[x\] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å docker-compose + gateway dependency
\[x\] –õ–∏–º–∏—Ç—ã Free/Premium + –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–µ–π
\[x\] Unit —Ç–µ—Å—Ç—ã billing-service
\[x\] README.md: –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Billing Service

10. –¢–µ—Å—Ç-–∫–µ–π—Å—ã (—Å–∫–≤–æ–∑–Ω—è–∫)

\[x\] –ò–º–ø–æ—Ä—Ç CSV/XLSX —Ü–µ–Ω ‚Üí prices
\[x\] –°–æ–∑–¥–∞—Ç—å –ª–æ—Ç ‚Üí —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å SKU ‚Üí —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ä–∂—É (calc-service)
\[x\] –†–∏—Å–∫-—Å–∫–æ—Ä–∏–Ω–≥ ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ risk_evaluations (risk-engine)
\[x\] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Å—å–º–æ (doc-service)

11. Telegram Bot ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ (—Å–º. test-plan.md)

\[x\] –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã: /start, /help, /key
\[x\] –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã: /lot, /search
\[x\] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Billing Service
\[x\] –ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ø–æ–∏—Å–∫ ‚Üí –∞–Ω–∞–ª–∏–∑)
\[x\] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook –∏ polling —Ä–µ–∂–∏–º–æ–≤
\[x\] –í–∞–ª–∏–¥–∞—Ü–∏—è rate limiting –∏ error handling

______________________________________________________________________

# ROADMAP: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ ZakupAI (Goszakup v2/v3 + AI)

> –≠—Ç–∞–ø—ã 1‚Äì3 –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ Confluence 2024-06). –§–æ–∫—É—Å –Ω–∞ Sprint 4.

Sprint 4 - Master Checklist (Hybrid, Final)

# ========================= Stage 4 - Week 1: Quick Wins

\[x\] –û—á–∏—Å—Ç–∫–∞ Docker-–º—É—Å–æ—Ä–∞
\[x\] docker system df (–æ—Ü–µ–Ω–∏—Ç—å –∑–∞–Ω–∏–º–∞–µ–º–æ–µ –º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π)
\[x\] docker image prune -a -f
\[x\] docker builder prune -a -f
\[x\] docker system prune -f --volumes
DoD: —Å–≤–æ–±–æ–¥–Ω–æ ‚â•5GB, –±–∏–ª–¥ –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏

\[x\] –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∫–æ–¥–∞
\[x\] —É–±—Ä–∞—Ç—å handlers_v2.py, commands_v2.py
\[x\] —É–¥–∞–ª–∏—Ç—å old_main.py –∏ backup\_\* —Ñ–∞–π–ª—ã
\[x\] –∑–∞–≤–µ—Å—Ç–∏ shared/ –¥–ª—è –æ–±—â–µ–≥–æ –∫–æ–¥–∞ (DB, –ª–æ–≥–≥–∏–Ω–≥, middleware)
DoD: unit + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

\[x\] CI/CD –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
\[x\] matrix build –≤ .github/workflows/ci.yml
\[x\] –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ pip –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
\[x\] –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ apt –ø–∞–∫–µ—Ç–æ–≤ (tesseract, jq)
\[x\] –¥–æ–±–∞–≤–∏—Ç—å Docker layer caching
DoD: –≤—Ä–µ–º—è CI —Å–æ–∫—Ä–∞—Ç–∏–ª–æ—Å—å –º–∏–Ω–∏–º—É–º –Ω–∞ 30%

# ========================= Stage 4 - Week 2: –§–∏—á–∏ —è–¥—Ä–∞

\[x\] ETL Batch Upload
\[x\] –¥–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç /etl/upload-batch –¥–ª—è CSV/XLSX
\[x\] —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É (—Å–Ω–∞—á–∞–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –æ—á–µ—Ä–µ–¥—å –ø–æ–∑–∂–µ)
\[x\] –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å n8n workflow
\[x\] –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV/XLSX
DoD: CSV ‚â§10 MB –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è \<5 —Å–µ–∫, –æ—à–∏–±–æ–∫ ‚â§1%

\[x\] RNU-–≤–∞–ª–∏–¥–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
\[x\] —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ /validate_rnu –≤ risk-engine
\[x\] –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (PostgreSQL/Redis, TTL=24—á)
\[x\] –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /rnu \<–ë–ò–ù> –≤ Telegram –±–æ—Ç–µ
\[x\] –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å fallback: –µ—Å–ª–∏ –∫–µ—à –ø—É—Å—Ç ‚Üí –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –≤ API
DoD: –æ—Ç–≤–µ—Ç –ø—Ä–∏ –∫—ç—à–µ ‚â§500 –º—Å, —É—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚â•95% —Å–ª—É—á–∞–µ–≤

\[x\] –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
\[x\] –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Å—É–º–º–∞–º (min_amount, max_amount)
\[x\] –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –ª–æ—Ç–æ–≤
\[x\] —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ Web UI (autocomplete.js)
\[x\] –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
DoD: –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–æ –Ω–∞ ‚â•2 —Å–µ–∫, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ ‚â•2 —Å–∏–º–≤–æ–ª–æ–≤

# ========================= Stage 4 - Week 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

\[x\] –î–æ—Ä–∞–±–æ—Ç–∫–∞ RNU-–≤–∞–ª–∏–¥–∞—Ü–∏–∏
\[x\] –¥–æ–±–∞–≤–∏—Ç—å TTL –∫–µ—à–∞ (24—á) –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
\[x\] —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
\[x\] –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö
DoD: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–µ –ø–æ–∑–∂–µ 5 –º–∏–Ω –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

\[x\] –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
\[x\] –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –ø–æ–¥ –±–æ–ª—å—à–∏–µ –≤—ã–±–æ—Ä–∫–∏
\[x\] –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ —Å—É–º–º–µ –∏ –¥–∞—Ç–µ
\[x\] –ø–æ–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏ /api/search/advanced
DoD: –ø–æ–∏—Å–∫ –ø–æ 100k –ª–æ—Ç–∞–º ‚â§2 —Å–µ–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

\[x\] Flowise –∞–≥–µ–Ω—Ç—ã (MVP)
\[x\] complaint-generator: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–∞–ª–æ–±—ã –ø–æ –ª–æ—Ç—É (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤—ã–≤–æ–¥)
\[x\] supplier-finder: –ø–æ–∏—Å–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ (—á–µ—Ä–µ–∑ Satu.kz/ChromaDB)
DoD: complaint-generator –≤—ã–¥–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –Ω–æ–º–µ—Ä–æ–º –ª–æ—Ç–∞, –ø—Ä–∏—á–∏–Ω–æ–π –∏ –¥–∞—Ç–æ–π; supplier-finder –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å ChromaDB

# ========================= Stage 4 - Week 4: UI, Flowise, E2E, Monitoring

\[x\] Web UI –¥–æ—Ä–∞–±–æ—Ç–∫–∏
\[x\] –∏–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–æ–≤ CSV
\[x\] TL;DR –∞–Ω–∞–ª–∏–∑–∞ –ª–æ—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /lot/{id}
\[x\] —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –ø–æ–∏—Å–∫–µ
DoD: make smoke + make test-priority3 –∑–µ–ª—ë–Ω—ã–µ; –∏–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤ ‚â§5 MB –∏ TL;DR –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è \<1 —Å–µ–∫

\[x\] Flowise –∞–≥–µ–Ω—Ç—ã (—Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è)
\[x\] complaint-generator: —É–ª—É—á—à–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∂–∞–ª–æ–±—ã (PDF/Word)
\[x\] supplier-finder: —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ä–µ–≥–∏–æ–Ω—É –∏ –±—é–¥–∂–µ—Ç—É
DoD: pytest tests/test_flowise_week4_2.py –∑–µ–ª—ë–Ω—ã–π; PDF/Word –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫, —Ñ–∏–ª—å—Ç—Ä—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫

\[x\] E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
\[x\] pytest —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è batch upload + RNU + advanced search
\[x\] bash smoke-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
\[x\] –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD (priority4-integration job)
DoD: make test-priority4 –∑–∞–≤–µ—Ä—à–∞–µ—Ç pytest + scripts/e2e/run_tests.py –±–µ–∑ –æ—à–∏–±–æ–∫; –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (CSV –∏–º–ø–æ—Ä—Ç, RNU) –ø–æ–∫—Ä—ã—Ç—ã

\[x\] Performance & Monitoring
\[x\] –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏—á (Locust/JMeter)
\[x\] –∞–ª–µ—Ä—Ç—ã –≤ Grafana –¥–ª—è batch upload –∏ –ø–æ–∏—Å–∫–∞
\[x\] –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ latency, error rate, CPU usage
DoD: make test-priority4 (pytest + scripts/e2e/run_tests.py + python test_metrics.py) –∑–µ–ª—ë–Ω—ã–π; –Ω–∞–≥—Ä—É–∑–∫–∞ ‚â•1000 req/min –∏ –∞–ª–µ—Ä—Ç—ã –∞–∫—Ç–∏–≤–Ω—ã –≤ Grafana

–§–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω Stage6
Stage6 Monitoring & Security:
Prometheus
\[x\] –î–æ–±–∞–≤–∏—Ç—å scrape targets –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (calc, risk, doc, embedding, gateway, etl)
\[ \] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ –≤–æ –≤—Å–µ FastAPI-—Å–µ—Ä–≤–∏—Å—ã
‚Äî anti-dumping %
‚Äî goszakup error counter

Loki

\[x\] –í–∫–ª—é—á–∏—Ç—å promtail –¥–ª—è —Å–±–æ—Ä–∞ docker-–ª–æ–≥–æ–≤
\[ \] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏: service, procurement_type, compliance_flag

Grafana

\[x\] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Prometheus –∏ Loki –∫–∞–∫ datasources —á–µ—Ä–µ–∑ provisioning
\[ \] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã:
‚Äî API latency
‚Äî HTTP 5xx errors
‚Äî Compliance events
\[ \] –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å zakupai-overview.json: –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ —Å–≤–æ–¥–Ω—ã–π –∏–ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π

Alertmanager

\[x\] –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å alerts.yml –≤ Prometheus
\[x\] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ ¬´>5 API –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥¬ª –∏ ¬´–∞–Ω—Ç–∏–¥–µ–º–ø–∏–Ω–≥ >15 %¬ª
\[x\] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π webhook (Telegram/Slack –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ gateway:8000/alert)

Vault

\[x\] –ü–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Vault
\[x\] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç—ã (DB, API) –∏–∑ ENV ‚Üí Vault
\[x\] –ü–æ–¥–∫–ª—é—á–∏—Ç—å hvac –≤ calc, etl, risk-engine –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤


–°–∫—Ä–∏–ø—Ç—ã

\[x\] –ù–æ–≤—ã–π stage6-monitoring-test.sh ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–Ω–Ω–µ—Ä


# ========================= Stage 7 ‚Äî Security & Audit

üéØ –¶–µ–ª—å: –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ZakupAI.  
–§–æ–∫—É—Å: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, Vault, mTLS, –∞—É–¥–∏—Ç, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

## Stage 7 ‚Äî Input Validation / Rate Limit / Docs

[x] –î–æ–±–∞–≤–∏—Ç—å Pydantic-–≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö API (max_length, ranges)  
[x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ payload (413 Payload Too Large)  
[x] –í–Ω–µ–¥—Ä–∏—Ç—å rate-limiter (–ø–æ API-–∫–ª—é—á—É / IP / user_id)  
[x] –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (422, 413, 401)  
[x] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å OpenAPI / Swagger –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ Docs-–ø–æ—Ä—Ç–∞–ª  
[x] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–æ–∂–∏–¥–∞–Ω–∏–µ 422 / 413)  
[x] –û–±–Ω–æ–≤–∏—Ç—å CI-workflows –¥–ª—è smoke-—Ç–µ—Å—Ç–æ–≤ Docs  
[ ] Fix gateway external port mapping and add /health endpoint
    - Ensure "8080:80" in docker-compose.yml
    - Add Nginx health location:
        location /health {
            return 200 '{"status":"ok"}';
            add_header Content-Type application/json;
        }
[x]Stage 7 Phase 1 ‚Äî Security Quick Wins (completed)
---

## Stage 7 ‚Äî Monitoring + Vault + Secrets

[x] –ü–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Vault (`hashicorp/vault:1.17`)  
‚ÄÉ‚Ä¢ –ö–æ–Ω—Ñ–∏–≥ ‚Üí `monitoring/vault/config.hcl`, –ø–æ—Ä—Ç 8200  
‚ÄÉ‚Ä¢ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å root-token –∏ CA  

[ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å `hvac` –≤ calc-service, etl-service, risk-engine  
‚ÄÉ‚Ä¢ –ß—Ç–µ–Ω–∏–µ DB credentials –∏ API keys –∏–∑ Vault –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ  
‚ÄÉ‚Ä¢ –ò—Å–∫–ª—é—á–∏—Ç—å `.env` –∏–∑ Docker build  
‚ÄÉ‚Ä¢ DoD: —Å–µ—Ä–≤–∏—Å—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –±–µ–∑ . env, —á–∏—Ç–∞—é—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ Vault  

[ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (DB URI, API keys, Telegram tokens)  
[ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Alertmanager webhook (—Ä–µ–∞–ª—å–Ω—ã–π Telegram / Slack)  
[ ] Business metrics (anti-dumping %, goszakup errors)


---

## Stage 7 ‚Äî mTLS –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

[ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π CA –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã  
[ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx reverse proxy —Å mutual TLS (ssl_verify_client on)  
[ ] –û–±–Ω–æ–≤–∏—Ç—å healthcheck –Ω–∞ GET /health (—Å TLS)  
[ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `curl --cert client.pem --key client.key` ‚Üí 200, –±–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ ‚Üí 403  

---

## Stage 7 ‚Äî Audit + Logging + Testing

[ ] –°–æ–∑–¥–∞—Ç—å `shared/audit.py` ‚Äî –∫–ª–∞—Å—Å `AuditLogger.log_access(user_id, resource, action)`  
[ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ –≤—Å–µ FastAPI-—Å–µ—Ä–≤–∏—Å—ã  
[ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å log retention –≤ Loki (3 –≥–æ–¥–∞, —Å–∂–∞—Ç–∏–µ –ø–æ—Å–ª–µ 180 –¥–Ω–µ–π)  
[ ] –ü—Ä–æ–≥–Ω–∞—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (Locust ‚â• 1000 req/min, P95 < 500 ms)  
[ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å `make security-scan` ‚Üí bandit + snyk + dependency-check (0 critical)

### üìä Stage 7 ‚Äî Summary
DoD:
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞—â–∏—â–µ–Ω—ã rate-limiter‚Äô–æ–º
- Vault –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤–æ –≤—Å–µ FastAPI-—Å–µ—Ä–≤–∏—Å—ã
- mTLS –≤–∫–ª—é—á—ë–Ω –º–µ–∂–¥—É gateway –∏ risk-engine
- AuditLogger –≤–µ–¥—ë—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (retention = 3 –≥–æ–¥–∞)
- Security scan –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ high-severity —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

---

## üßæ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ CI

[ ] –î–æ–±–∞–≤–∏—Ç—å `STAGE7_SECURITY_AUDIT_PLAN.md` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π  
[ ] –û–±–Ω–æ–≤–∏—Ç—å `.github/workflows/ci-optimized.yml` –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ security scan  
[ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å README —Ä–∞–∑–¥–µ–ª ¬´–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥¬ª  
[ ] DoD: CI –∑–µ–ª—ë–Ω—ã–π, security-scan 0 critical, –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã.


### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

- [ ] –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã + rate limits)
  DoD: make test-priority4 + security scan (bandit/snyk) –∑–µ–ª—ë–Ω—ã–µ; –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚â•1000 req/min –±–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Makefile

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–µ–π: `make smoke`, `make test-priority3`, `make test-priority4` ‚Äì –¥–æ—Å—Ç—É–ø–Ω—ã.

- –ö–∞—Ä—Ç–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫:

  - `make smoke` ‚Äì –±–∞–∑–æ–≤—ã–µ smoke –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
  - `make test-priority3` ‚Äì E2E –ø–∞–π–ø–ª–∞–π–Ω (ETL ‚Üí Chroma ‚Üí Web UI)
  - `make test-priority4` ‚Äì Flowise pytest + gateway E2E + –º–µ—Ç—Ä–∏–∫–∏

- [ ] –ó–∞–ø—É—Å–∫ –ø–∏–ª–æ—Ç–∞ —Å —Ñ–æ–∫—É—Å-–≥—Ä—É–ø–ø–æ–π (10-20 –∫–æ–º–ø–∞–Ω–∏–π)
  DoD: –ø–æ–¥–ø–∏—Å–∞–Ω—ã –¥–æ–≥–æ–≤–æ—Ä—ã —Å ‚â•10 –∫–æ–º–ø–∞–Ω–∏—è–º–∏, —Å–æ–±—Ä–∞–Ω—ã –æ—Ç–∑—ã–≤—ã, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –æ—Ç—á—ë—Ç –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –ø–∏–ª–æ—Ç–∞
