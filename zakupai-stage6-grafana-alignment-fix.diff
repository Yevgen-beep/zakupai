--- monitoring/grafana/provisioning/dashboards/overview/zakupai-overview.json.bak	2025-10-16 09:36:49.203691384 +0500
+++ monitoring/grafana/provisioning/dashboards/overview/zakupai-overview.json	2025-10-16 10:16:13.253112640 +0500
@@ -5,13 +5,19 @@
   "schemaVersion": 38,
   "version": 1,
   "refresh": "10s",
-  "time": {"from": "now-1h", "to": "now"},
+  "time": {
+    "from": "now-1h",
+    "to": "now"
+  },
   "panels": [
     {
       "type": "stat",
       "title": "Availability (last 5m)",
       "id": 1,
-      "datasource": {"type": "prometheus", "uid": "zakupai-prom"},
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
       "targets": [
         {
           "expr": "(1 - avg(api_error_ratio)) * 100",
@@ -25,9 +31,18 @@
           "thresholds": {
             "mode": "percentage",
             "steps": [
-              {"color": "red", "value": 0},
-              {"color": "yellow", "value": 99},
-              {"color": "green", "value": 99.9}
+              {
+                "color": "red",
+                "value": 0
+              },
+              {
+                "color": "yellow",
+                "value": 99
+              },
+              {
+                "color": "green",
+                "value": 99.9
+              }
             ]
           }
         },
@@ -35,7 +50,9 @@
       },
       "options": {
         "reduceOptions": {
-          "calcs": ["lastNotNull"],
+          "calcs": [
+            "lastNotNull"
+          ],
           "fields": "",
           "values": false
         },
@@ -44,13 +61,21 @@
         "graphMode": "none",
         "justifyMode": "auto"
       },
-      "gridPos": {"h": 6, "w": 6, "x": 0, "y": 0}
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 0,
+        "y": 0
+      }
     },
     {
       "type": "stat",
       "title": "Error Ratio (last 5m)",
       "id": 2,
-      "datasource": {"type": "prometheus", "uid": "zakupai-prom"},
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
       "targets": [
         {
           "expr": "avg(api_error_ratio) * 100",
@@ -64,9 +89,18 @@
           "thresholds": {
             "mode": "absolute",
             "steps": [
-              {"color": "green", "value": 0},
-              {"color": "yellow", "value": 1},
-              {"color": "red", "value": 2}
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "yellow",
+                "value": 1
+              },
+              {
+                "color": "red",
+                "value": 2
+              }
             ]
           }
         },
@@ -74,7 +108,9 @@
       },
       "options": {
         "reduceOptions": {
-          "calcs": ["lastNotNull"],
+          "calcs": [
+            "lastNotNull"
+          ],
           "fields": "",
           "values": false
         },
@@ -83,13 +119,21 @@
         "graphMode": "none",
         "justifyMode": "auto"
       },
-      "gridPos": {"h": 6, "w": 6, "x": 6, "y": 0}
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 6,
+        "y": 0
+      }
     },
     {
       "type": "stat",
       "title": "API P95 Latency (last 5m)",
       "id": 3,
-      "datasource": {"type": "prometheus", "uid": "zakupai-prom"},
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
       "targets": [
         {
           "expr": "max(api_p95_latency)",
@@ -103,9 +147,18 @@
           "thresholds": {
             "mode": "absolute",
             "steps": [
-              {"color": "green", "value": 0},
-              {"color": "yellow", "value": 0.5},
-              {"color": "red", "value": 1}
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "yellow",
+                "value": 0.5
+              },
+              {
+                "color": "red",
+                "value": 1
+              }
             ]
           }
         },
@@ -113,7 +166,9 @@
       },
       "options": {
         "reduceOptions": {
-          "calcs": ["lastNotNull"],
+          "calcs": [
+            "lastNotNull"
+          ],
           "fields": "",
           "values": false
         },
@@ -122,51 +177,73 @@
         "graphMode": "none",
         "justifyMode": "auto"
       },
-      "gridPos": {"h": 6, "w": 6, "x": 12, "y": 0}
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 12,
+        "y": 0
+      }
     },
     {
       "type": "timeseries",
-      "title": "Total Requests by Service",
+      "title": "Request Rate by Job",
       "id": 4,
-      "datasource": {"type": "prometheus", "uid": "zakupai-prom"},
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
       "targets": [
         {
-          "expr": "sum by (job) (http_requests_total)",
+          "expr": "sum by (job) (irate(http_requests_total[2m]))",
           "refId": "A",
           "legendFormat": "{{job}}",
-          "instant": true,
-          "range": false
+          "instant": false,
+          "range": true
         }
       ],
       "fieldConfig": {
         "defaults": {
-          "unit": "short",
+          "unit": "reqps",
           "custom": {
             "drawStyle": "line",
             "lineInterpolation": "smooth",
             "showPoints": "never"
-          }
+          },
+          "decimals": 2
         },
         "overrides": []
       },
       "options": {
-        "legend": {"displayMode": "table", "placement": "right"},
-        "tooltip": {"mode": "multi"}
+        "legend": {
+          "displayMode": "table",
+          "placement": "right"
+        },
+        "tooltip": {
+          "mode": "multi"
+        }
       },
-      "gridPos": {"h": 9, "w": 12, "x": 0, "y": 6}
+      "gridPos": {
+        "h": 9,
+        "w": 12,
+        "x": 0,
+        "y": 6
+      }
     },
     {
       "type": "timeseries",
-      "title": "Error Ratio by Service",
+      "title": "5xx Error Rate by Job",
       "id": 5,
-      "datasource": {"type": "prometheus", "uid": "zakupai-prom"},
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
       "targets": [
         {
-          "expr": "sum by (job) (http_requests_total{status_code=~\"5..\"}) / clamp_min(sum by (job) (http_requests_total), 1)",
+          "expr": "sum(rate(http_requests_total{status_code=~\"5..\"}[5m]) or rate(http_requests_total[5m])*0) by (job) / clamp_min(sum(rate(http_requests_total[5m])) by (job), 1)",
           "refId": "A",
           "legendFormat": "{{job}}",
-          "instant": true,
-          "range": false
+          "instant": false,
+          "range": true
         }
       ],
       "fieldConfig": {
@@ -182,13 +259,283 @@
         "overrides": []
       },
       "options": {
-        "legend": {"displayMode": "table", "placement": "right"},
-        "tooltip": {"mode": "multi"}
+        "legend": {
+          "displayMode": "table",
+          "placement": "right"
+        },
+        "tooltip": {
+          "mode": "multi"
+        }
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 12,
+        "x": 12,
+        "y": 6
+      }
+    },
+    {
+      "type": "stat",
+      "title": "Node CPU Usage",
+      "id": 6,
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
+      "targets": [
+        {
+          "expr": "avg(rate(node_cpu_seconds_total{job=\"node-exporter\",mode!=\"idle\"}[5m])) * 100",
+          "refId": "A"
+        }
+      ],
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 0,
+        "y": 15
+      },
+      "fieldConfig": {
+        "defaults": {
+          "decimals": 2,
+          "thresholds": {
+            "mode": "percentage",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "yellow",
+                "value": 70
+              },
+              {
+                "color": "red",
+                "value": 90
+              }
+            ]
+          },
+          "unit": "percent"
+        },
+        "overrides": []
+      },
+      "options": {
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "orientation": "horizontal",
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto"
+      }
+    },
+    {
+      "type": "stat",
+      "title": "Node Memory Usage",
+      "id": 7,
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
+      "targets": [
+        {
+          "expr": "100 * (1 - avg(node_memory_MemAvailable_bytes{job=\"node-exporter\"}) / avg(node_memory_MemTotal_bytes{job=\"node-exporter\"}))",
+          "refId": "A"
+        }
+      ],
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 6,
+        "y": 15
+      },
+      "fieldConfig": {
+        "defaults": {
+          "decimals": 2,
+          "thresholds": {
+            "mode": "percentage",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "yellow",
+                "value": 70
+              },
+              {
+                "color": "red",
+                "value": 85
+              }
+            ]
+          },
+          "unit": "percent"
+        },
+        "overrides": []
+      },
+      "options": {
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "orientation": "horizontal",
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto"
+      }
+    },
+    {
+      "type": "stat",
+      "title": "Bot Status",
+      "id": 8,
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
+      "targets": [
+        {
+          "expr": "max(zakupai_bot_up)",
+          "refId": "A"
+        }
+      ],
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 12,
+        "y": 15
+      },
+      "fieldConfig": {
+        "defaults": {
+          "decimals": 0,
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": 0
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "options": {
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "orientation": "horizontal",
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto"
+      }
+    },
+    {
+      "type": "timeseries",
+      "title": "Bot CPU Usage",
+      "id": 9,
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
+      "targets": [
+        {
+          "expr": "sum(rate(container_cpu_usage_seconds_total{job=\"cadvisor\",name=~\"zakupai-bot.*\"}[5m])) * 100",
+          "refId": "A",
+          "legendFormat": "Bot CPU",
+          "instant": false,
+          "range": true
+        }
+      ],
+      "fieldConfig": {
+        "defaults": {
+          "unit": "percent",
+          "decimals": 2,
+          "custom": {
+            "drawStyle": "line",
+            "lineInterpolation": "smooth",
+            "showPoints": "auto"
+          }
+        },
+        "overrides": []
+      },
+      "options": {
+        "legend": {
+          "displayMode": "list",
+          "placement": "right"
+        },
+        "tooltip": {
+          "mode": "multi"
+        }
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 12,
+        "x": 0,
+        "y": 21
+      }
+    },
+    {
+      "type": "timeseries",
+      "title": "Bot Memory Usage",
+      "id": 10,
+      "datasource": {
+        "type": "prometheus",
+        "uid": "zakupai-prom"
+      },
+      "targets": [
+        {
+          "expr": "sum(container_memory_usage_bytes{job=\"cadvisor\",name=~\"zakupai-bot.*\"}) / 1024 / 1024",
+          "refId": "A",
+          "legendFormat": "Bot Memory",
+          "instant": false,
+          "range": true
+        }
+      ],
+      "fieldConfig": {
+        "defaults": {
+          "unit": "megabytes",
+          "decimals": 1,
+          "custom": {
+            "drawStyle": "line",
+            "lineInterpolation": "smooth",
+            "showPoints": "auto"
+          }
+        },
+        "overrides": []
+      },
+      "options": {
+        "legend": {
+          "displayMode": "list",
+          "placement": "right"
+        },
+        "tooltip": {
+          "mode": "multi"
+        }
       },
-      "gridPos": {"h": 9, "w": 12, "x": 12, "y": 6}
+      "gridPos": {
+        "h": 9,
+        "w": 12,
+        "x": 12,
+        "y": 21
+      }
     }
   ],
   "templating": {
     "list": []
   }
-}
+}
\ В конце файла нет новой строки
--- monitoring/grafana/provisioning/datasources/datasources.yml.bak	2025-10-16 09:36:32.332149904 +0500
+++ monitoring/grafana/provisioning/datasources/datasources.yml	2025-10-16 09:36:41.573446878 +0500
@@ -3,7 +3,7 @@
   - name: Prometheus
     uid: zakupai-prom
     type: prometheus
-    url: http://prometheus:9090
+    url: http://prometheus:9095
     access: proxy
     isDefault: true
   - name: Loki
