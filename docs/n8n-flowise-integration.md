# n8n Ğ¸ Flowise Integration

## ĞĞ±Ğ·Ğ¾Ñ€

ZakupAI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ n8n Ğ¸ Flowise Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… AI-Ğ²Ğ¾Ñ€ĞºÑ„Ğ»Ğ¾Ñƒ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ². Ğ­Ñ‚Ğ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ñ‹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ² Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Automation Stack                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚   Flowise   â”‚ â”‚     n8n     â”‚ â”‚  ZakupAI    â”‚                 â”‚
â”‚ â”‚  :3000      â”‚ â”‚   :5678     â”‚ â”‚  Services   â”‚                 â”‚
â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚                 â”‚
â”‚ â”‚ Visual AI   â”‚ â”‚ Workflow    â”‚ â”‚ â€¢ Calc      â”‚                 â”‚
â”‚ â”‚ Workflows   â”‚ â”‚ Engine      â”‚ â”‚ â€¢ Risk      â”‚                 â”‚
â”‚ â”‚             â”‚ â”‚             â”‚ â”‚ â€¢ Doc       â”‚                 â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â€¢ Billing   â”‚                 â”‚
â”‚        â”‚               â”‚        â”‚ â€¢ Embedding â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                 â”‚
â”‚                        â”‚                      â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚              â”‚ Custom Nodes   â”‚    â”‚ Custom Tools   â”‚          â”‚
â”‚              â”‚ (n8n)         â”‚    â”‚ (Flowise)      â”‚          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## n8n Custom Nodes

### 1. GosZakup-RK Node

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ»Ğ¾Ğ¼ Ğ³Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°ĞºÑƒĞ¿Ğ¾Ğº Ğ Ğš

**Ğ¤Ğ°Ğ¹Ğ»:** `n8n-nodes/goszakup-rk/GosZakupRK.node.ts`

```typescript
import {
    IExecuteFunctions,
    INodeExecutionData,
    INodeType,
    INodeTypeDescription,
} from 'n8n-workflow';

export class GosZakupRK implements INodeType {
    description: INodeTypeDescription = {
        displayName: 'GosZakup RK',
        name: 'gosZakupRK',
        icon: 'file:goszakup.svg',
        group: ['transform'],
        version: 1,
        description: 'Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ»Ğ¾Ğ¼ Ğ³Ğ¾ÑĞ·Ğ°ĞºÑƒĞ¿Ğ¾Ğº Ğ Ğš',
        defaults: {
            name: 'GosZakup RK',
        },
        inputs: ['main'],
        outputs: ['main'],
        properties: [
            {
                displayName: 'Operation',
                name: 'operation',
                type: 'options',
                options: [
                    {
                        name: 'ĞŸĞ¾Ğ¸ÑĞº Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ²',
                        value: 'searchTenders',
                    },
                    {
                        name: 'ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ñ‚',
                        value: 'getLot',
                    },
                    {
                        name: 'ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ»Ğ¾Ñ‚Ğ¾Ğ²',
                        value: 'monitorLots',
                    },
                ],
                default: 'searchTenders',
            },
            {
                displayName: 'Lot ID',
                name: 'lotId',
                type: 'string',
                displayOptions: {
                    show: {
                        operation: ['getLot'],
                    },
                },
                default: '',
                description: 'ID Ğ»Ğ¾Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…',
            },
            {
                displayName: 'Search Query',
                name: 'searchQuery',
                type: 'string',
                displayOptions: {
                    show: {
                        operation: ['searchTenders'],
                    },
                },
                default: '',
                description: 'ĞŸĞ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ²',
            },
        ],
    };

    async execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {
        const items = this.getInputData();
        const returnData: INodeExecutionData[] = [];

        for (let i = 0; i < items.length; i++) {
            const operation = this.getNodeParameter('operation', i) as string;

            try {
                if (operation === 'getLot') {
                    const lotId = this.getNodeParameter('lotId', i) as string;

                    // Ğ’Ñ‹Ğ·Ğ¾Ğ² ZakupAI API Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ»Ğ¾Ñ‚Ğ°
                    const response = await this.helpers.request({
                        method: 'GET',
                        url: `https://goszakup.gov.kz/ru/announce/index/${lotId}`,
                        json: true,
                    });

                    returnData.push({
                        json: {
                            lot_id: lotId,
                            title: response.title,
                            price: response.price,
                            customer: response.customer,
                            deadline: response.deadline,
                            status: response.status,
                            fetched_at: new Date().toISOString(),
                        },
                    });

                } else if (operation === 'searchTenders') {
                    const searchQuery = this.getNodeParameter('searchQuery', i) as string;

                    // ĞŸĞ¾Ğ¸ÑĞº Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· API
                    const response = await this.helpers.request({
                        method: 'GET',
                        url: `https://goszakup.gov.kz/api/v1/search`,
                        qs: {
                            query: searchQuery,
                            limit: 50,
                        },
                        json: true,
                    });

                    response.data.forEach((tender: any) => {
                        returnData.push({
                            json: {
                                lot_id: tender.id,
                                title: tender.title,
                                price: tender.price,
                                customer: tender.customer.name,
                                publication_date: tender.published_at,
                            },
                        });
                    });

                } else if (operation === 'monitorLots') {
                    // ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ "Ğ³Ğ¾Ñ€ÑÑ‡Ğ¸Ñ…" Ğ»Ğ¾Ñ‚Ğ¾Ğ²
                    const hotLots = await this.helpers.request({
                        method: 'GET',
                        url: 'http://zakupai-gateway/api/lots/hot',
                        headers: {
                            'X-API-Key': process.env.ZAKUPAI_API_KEY,
                        },
                        json: true,
                    });

                    hotLots.forEach((lot: any) => {
                        returnData.push({
                            json: {
                                ...lot,
                                alert_type: 'hot_lot',
                                checked_at: new Date().toISOString(),
                            },
                        });
                    });
                }

            } catch (error) {
                if (this.continueOnFail()) {
                    returnData.push({
                        json: { error: error.message },
                    });
                } else {
                    throw error;
                }
            }
        }

        return [returnData];
    }
}
```

### 2. Price Aggregator Node

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ¡Ğ±Ğ¾Ñ€ Ñ€Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ñ†ĞµĞ½ Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²

**Ğ¤Ğ°Ğ¹Ğ»:** `n8n-nodes/price-aggregator/PriceAggregator.node.ts`

```typescript
export class PriceAggregator implements INodeType {
    description: INodeTypeDescription = {
        displayName: 'Price Aggregator',
        name: 'priceAggregator',
        icon: 'file:price.svg',
        group: ['transform'],
        version: 1,
        description: 'ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ñ€Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ñ†ĞµĞ½ Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²',
        properties: [
            {
                displayName: 'Source',
                name: 'source',
                type: 'options',
                options: [
                    { name: '1688.com', value: '1688' },
                    { name: 'Alibaba', value: 'alibaba' },
                    { name: 'Kaspi ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½', value: 'kaspi' },
                    { name: 'Manual Input', value: 'manual' },
                ],
                default: '1688',
            },
            {
                displayName: 'Product SKU',
                name: 'sku',
                type: 'string',
                default: '',
                description: 'ĞÑ€Ñ‚Ğ¸ĞºÑƒĞ» Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ†ĞµĞ½Ñ‹',
            },
        ],
    };

    async execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {
        const items = this.getInputData();
        const returnData: INodeExecutionData[] = [];

        for (let i = 0; i < items.length; i++) {
            const source = this.getNodeParameter('source', i) as string;
            const sku = this.getNodeParameter('sku', i) as string;

            try {
                // Ğ’Ñ‹Ğ·Ğ¾Ğ² ZakupAI Price API
                const priceData = await this.helpers.request({
                    method: 'POST',
                    url: 'http://zakupai-gateway/api/prices/aggregate',
                    headers: {
                        'X-API-Key': process.env.ZAKUPAI_API_KEY,
                    },
                    json: {
                        source: source,
                        sku: sku,
                        search_alternatives: true,
                    },
                });

                returnData.push({
                    json: {
                        sku: sku,
                        source: source,
                        prices: priceData.prices,
                        min_price: priceData.min_price,
                        max_price: priceData.max_price,
                        avg_price: priceData.avg_price,
                        currency: priceData.currency,
                        found_items: priceData.found_items,
                        updated_at: new Date().toISOString(),
                    },
                });

            } catch (error) {
                if (this.continueOnFail()) {
                    returnData.push({
                        json: {
                            sku: sku,
                            source: source,
                            error: error.message
                        },
                    });
                } else {
                    throw error;
                }
            }
        }

        return [returnData];
    }
}
```

### 3. Tender Finance Calculator Node

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ²

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**

- Ğ Ğ°ÑÑ‡ĞµÑ‚ ĞĞ”Ğ¡
- ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¼Ğ°Ñ€Ğ¶Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
- Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ¿ĞµĞ½Ğ¸ Ğ¸ ÑˆÑ‚Ñ€Ğ°Ñ„Ğ¾Ğ²
- ROI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·

### 4. Lot Risk Scoring Node

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞÑ†ĞµĞ½ĞºĞ° Ñ€Ğ¸ÑĞºĞ¾Ğ² ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ñ Ğ² Ğ»Ğ¾Ñ‚Ğµ

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**

- ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°ĞºĞ°Ğ·Ñ‡Ğ¸ĞºĞ°
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ¾Ğ²
- ĞÑ†ĞµĞ½ĞºĞ° Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹
- Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ°

### 5. Doc Builder Node

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**

- ĞšĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ
- Ğ–Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ğ¸ Ğ²Ğ¾Ğ·Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
- Ğ”Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹ Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ

## Flowise Custom Tools

### 1. Lot Reader Tool

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ‚ĞµĞºÑÑ‚Ğ° Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ°

**Ğ¤Ğ°Ğ¹Ğ»:** `flowise-tools/lot-reader.js`

```javascript
class LotReaderTool {
    constructor() {
        this.name = "lot-reader";
        this.description = "Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ½ÑƒÑ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ";
    }

    async _call(input) {
        const { lotId, analysisType = "full" } = JSON.parse(input);

        try {
            // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ñ‚Ğ°
            const response = await fetch(`http://zakupai-gateway/api/lots/${lotId}`, {
                headers: {
                    'X-API-Key': process.env.ZAKUPAI_API_KEY,
                }
            });

            const lotData = await response.json();

            // Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Doc Service Ğ´Ğ»Ñ TL;DR
            const tldrResponse = await fetch('http://doc-service:8000/tldr', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': process.env.ZAKUPAI_API_KEY,
                },
                body: JSON.stringify({
                    lot_id: lotId,
                    include_risks: analysisType === "full",
                    language: "ru"
                })
            });

            const tldr = await tldrResponse.json();

            return {
                lot_id: lotId,
                title: lotData.title,
                summary: tldr.summary,
                key_requirements: tldr.key_requirements,
                estimated_price: lotData.price,
                deadline: lotData.deadline,
                complexity_score: tldr.complexity_score,
                recommended_action: tldr.recommended_action
            };

        } catch (error) {
            throw new Error(`Lot Reader failed: ${error.message}`);
        }
    }
}

module.exports = { LotReaderTool };
```

### 2. Risk Explain Tool

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞĞ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ¸ÑĞºĞ¾Ğ² ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ñ Ğ² Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğµ

**Ğ¤Ğ°Ğ¹Ğ»:** `flowise-tools/risk-explain.js`

```javascript
class RiskExplainTool {
    constructor() {
        this.name = "risk-explain";
        this.description = "ĞĞ±ÑŠÑÑĞ½ÑĞµÑ‚ Ñ€Ğ¸ÑĞºĞ¸ ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ñ Ğ² Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğµ Ğ¸ Ğ´Ğ°ĞµÑ‚ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸";
    }

    async _call(input) {
        const { lotId, riskCategories = "all" } = JSON.parse(input);

        try {
            // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ€Ğ¸ÑĞº-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
            const riskResponse = await fetch('http://risk-engine:8000/risk/explain/' + lotId, {
                headers: {
                    'X-API-Key': process.env.ZAKUPAI_API_KEY,
                }
            });

            const riskData = await riskResponse.json();

            // Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ LLM
            const explanation = {
                overall_risk_score: riskData.score,
                risk_level: this.getRiskLevel(riskData.score),
                detailed_risks: {
                    customer_risk: {
                        score: riskData.customer_risk,
                        explanation: riskData.customer_explanation,
                        mitigation: riskData.customer_mitigation
                    },
                    technical_risk: {
                        score: riskData.technical_risk,
                        explanation: riskData.technical_explanation,
                        mitigation: riskData.technical_mitigation
                    },
                    financial_risk: {
                        score: riskData.financial_risk,
                        explanation: riskData.financial_explanation,
                        mitigation: riskData.financial_mitigation
                    }
                },
                recommendations: riskData.recommendations,
                red_flags: riskData.red_flags,
                green_flags: riskData.green_flags
            };

            return explanation;

        } catch (error) {
            throw new Error(`Risk Explain failed: ${error.message}`);
        }
    }

    getRiskLevel(score) {
        if (score < 0.3) return "ĞĞ¸Ğ·ĞºĞ¸Ğ¹";
        if (score < 0.7) return "Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹";
        return "Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹";
    }
}

module.exports = { RiskExplainTool };
```

### 3. Finance Calculator Tool

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ€ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

**Ğ¤Ğ°Ğ¹Ğ»:** `flowise-tools/finance-calc.js`

```javascript
class FinanceCalculatorTool {
    constructor() {
        this.name = "finance-calc";
        this.description = "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ°";
    }

    async _call(input) {
        const {
            lotId,
            costPrice,
            proposedPrice,
            vatRate = 0.12,
            calculationType = "full"
        } = JSON.parse(input);

        try {
            const calculations = {};

            // ĞĞ”Ğ¡ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹
            if (calculationType === "full" || calculationType === "vat") {
                const vatResponse = await fetch('http://calc-service:8000/calc/vat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': process.env.ZAKUPAI_API_KEY,
                    },
                    body: JSON.stringify({
                        amount: proposedPrice,
                        vat_rate: vatRate
                    })
                });
                calculations.vat = await vatResponse.json();
            }

            // ĞœĞ°Ñ€Ğ¶Ğ° Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
            if (calculationType === "full" || calculationType === "margin") {
                const marginResponse = await fetch('http://calc-service:8000/calc/margin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': process.env.ZAKUPAI_API_KEY,
                    },
                    body: JSON.stringify({
                        cost_price: costPrice,
                        selling_price: proposedPrice,
                        quantity: 1
                    })
                });
                calculations.margin = await marginResponse.json();
            }

            // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹
            calculations.roi = ((proposedPrice - costPrice) / costPrice * 100).toFixed(2);
            calculations.breakeven_point = costPrice;
            calculations.profit_margin_percent = (((proposedPrice - costPrice) / proposedPrice) * 100).toFixed(2);

            return {
                lot_id: lotId,
                financial_summary: {
                    cost_price: costPrice,
                    proposed_price: proposedPrice,
                    gross_profit: proposedPrice - costPrice,
                    roi_percent: calculations.roi,
                    profit_margin_percent: calculations.profit_margin_percent
                },
                vat_details: calculations.vat,
                margin_analysis: calculations.margin,
                recommendation: this.getRecommendation(calculations.roi)
            };

        } catch (error) {
            throw new Error(`Finance Calculator failed: ${error.message}`);
        }
    }

    getRecommendation(roi) {
        const roiNum = parseFloat(roi);
        if (roiNum > 30) return "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ€ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ - Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼ ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ğµ";
        if (roiNum > 15) return "Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ñ€ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ - ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ğµ Ğ¾Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ½Ğ¾";
        if (roiNum > 5) return "ĞĞ¸Ğ·ĞºĞ°Ñ Ñ€ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ - Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ¸ÑĞºĞ¾Ğ²";
        return "Ğ£Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ - Ğ½Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼ ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ğµ";
    }
}

module.exports = { FinanceCalculatorTool };
```

### 4. Template Generator Tool

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**

- ĞšĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
- Ğ¡Ğ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¸ÑÑŒĞ¼Ğ°
- Ğ–Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ğ¸ Ğ²Ğ¾Ğ·Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Workflow

### 1. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ñ‚Ğ°

```json
{
  "name": "Auto Lot Analysis",
  "nodes": [
    {
      "id": "trigger",
      "type": "n8n-nodes-base.cron",
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "hour": 9,
              "minute": 0
            }
          ]
        }
      }
    },
    {
      "id": "fetch-new-lots",
      "type": "goszakup-rk",
      "parameters": {
        "operation": "searchTenders",
        "searchQuery": "Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾Ğµ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡ĞµĞ½Ğ¸Ğµ"
      }
    },
    {
      "id": "filter-interesting",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": "// Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ğµ Ğ»Ğ¾Ñ‚Ñ‹\nconst items = $input.all();\nconst filtered = items.filter(item => {\n  const price = parseFloat(item.json.price);\n  return price >= 500000 && price <= 10000000;\n});\nreturn filtered;"
      }
    },
    {
      "id": "analyze-risk",
      "type": "lot-risk-scoring",
      "parameters": {
        "lotId": "={{ $json.lot_id }}",
        "analysisDepth": "full"
      }
    },
    {
      "id": "calculate-finances",
      "type": "tender-finance-calc",
      "parameters": {
        "lotId": "={{ $json.lot_id }}",
        "estimatedCost": "={{ $json.price * 0.7 }}",
        "proposedPrice": "={{ $json.price }}"
      }
    },
    {
      "id": "generate-report",
      "type": "doc-builder",
      "parameters": {
        "template": "lot_analysis_report",
        "data": {
          "lot_data": "={{ $('fetch-new-lots').item.json }}",
          "risk_analysis": "={{ $('analyze-risk').item.json }}",
          "financial_calc": "={{ $('calculate-finances').item.json }}"
        }
      }
    },
    {
      "id": "send-notification",
      "type": "n8n-nodes-base.telegram",
      "parameters": {
        "chatId": "@zakupai_alerts",
        "text": "ğŸ¯ ĞĞ°Ğ¹Ğ´ĞµĞ½ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ğ¹ Ğ»Ğ¾Ñ‚:\n\nĞ›Ğ¾Ñ‚: {{ $('fetch-new-lots').item.json.title }}\nĞ¦ĞµĞ½Ğ°: {{ $('fetch-new-lots').item.json.price }} â‚¸\nĞ Ğ¸ÑĞº: {{ $('analyze-risk').item.json.risk_level }}\nROI: {{ $('calculate-finances').item.json.roi_percent }}%\n\nğŸ“Š ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚: {{ $('generate-report').item.json.report_url }}"
      }
    }
  ],
  "connections": {
    "trigger": { "main": [["fetch-new-lots"]] },
    "fetch-new-lots": { "main": [["filter-interesting"]] },
    "filter-interesting": { "main": [["analyze-risk"]] },
    "analyze-risk": { "main": [["calculate-finances"]] },
    "calculate-finances": { "main": [["generate-report"]] },
    "generate-report": { "main": [["send-notification"]] }
  }
}
```

### 2. Flowise AI Agent Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ»Ğ¾Ñ‚Ğ¾Ğ²

```json
{
  "name": "Lot Analysis AI Agent",
  "description": "Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ³ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ½Ñ‹Ñ… Ğ»Ğ¾Ñ‚Ğ¾Ğ²",
  "chatflow": {
    "nodes": [
      {
        "id": "llm",
        "type": "ChatOpenAI",
        "data": {
          "model": "gpt-4",
          "temperature": 0.1,
          "systemMessage": "Ğ¢Ñ‹ ÑĞºÑĞ¿ĞµÑ€Ñ‚ Ğ¿Ğ¾ Ğ³Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ·Ğ°ĞºÑƒĞ¿ĞºĞ°Ğ¼. ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹ Ğ»Ğ¾Ñ‚Ñ‹ Ğ¸ Ğ´Ğ°Ğ²Ğ°Ğ¹ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ñ."
        }
      },
      {
        "id": "lotReader",
        "type": "CustomTool",
        "data": {
          "name": "lot-reader",
          "description": "Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ½ÑƒÑ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ"
        }
      },
      {
        "id": "riskExplain",
        "type": "CustomTool",
        "data": {
          "name": "risk-explain",
          "description": "ĞĞ±ÑŠÑÑĞ½ÑĞµÑ‚ Ñ€Ğ¸ÑĞºĞ¸ ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ñ Ğ² Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğµ"
        }
      },
      {
        "id": "financeCalc",
        "type": "CustomTool",
        "data": {
          "name": "finance-calc",
          "description": "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ°"
        }
      }
    ],
    "edges": [
      {
        "source": "llm",
        "target": "lotReader"
      },
      {
        "source": "llm",
        "target": "riskExplain"
      },
      {
        "source": "llm",
        "target": "financeCalc"
      }
    ]
  },
  "example_conversation": [
    {
      "user": "ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹ Ğ»Ğ¾Ñ‚ 12345 Ğ½Ğ° ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ğµ",
      "assistant": "ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ Ğ»Ğ¾Ñ‚ 12345...\n\n*Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ lot-reader*\nğŸ“‹ ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:\n- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ\n- Ğ¦ĞµĞ½Ğ°: 2,500,000 â‚¸\n- Ğ¡Ñ€Ğ¾Ğº: 45 Ğ´Ğ½ĞµĞ¹\n- Ğ—Ğ°ĞºĞ°Ğ·Ñ‡Ğ¸Ğº: ĞĞ \"ĞšĞ°Ğ·Ğ¿Ğ¾Ñ‡Ñ‚Ğ°\"\n\n*Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ risk-explain*\nâš ï¸ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ¸ÑĞºĞ¾Ğ²:\n- ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ¸ÑĞº: Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ (0.45)\n- Ğ Ğ¸ÑĞº Ğ·Ğ°ĞºĞ°Ğ·Ñ‡Ğ¸ĞºĞ°: ĞĞ¸Ğ·ĞºĞ¸Ğ¹ - Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ñ‹Ğ¹ Ğ³Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·Ñ‡Ğ¸Ğº\n- Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº: Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ - Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ\n- Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ¸ÑĞº: ĞĞ¸Ğ·ĞºĞ¸Ğ¹ - Ñ†ĞµĞ½Ğ° Ğ°Ğ´ĞµĞºĞ²Ğ°Ñ‚Ğ½Ğ°Ñ\n\n*Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ finance-calc*\nğŸ’° Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·:\n- ĞŸÑ€Ğ¸ ÑĞµĞ±ĞµÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ 1,800,000 â‚¸:\n- Ğ’Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ: 700,000 â‚¸\n- ROI: 38.89%\n- Ğ ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: 28%\n\nâœ… **Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ**: Ğ£Ñ‡Ğ°ÑÑ‚Ğ¸Ğµ Ğ² Ğ»Ğ¾Ñ‚Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ. Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ñ€ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ¸ÑĞºĞ°Ñ…."
    }
  ]
}
```

## Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

### Docker ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

**n8n service Ğ² docker-compose.yml:**

```yaml
n8n:
  image: n8nio/n8n:1.105.4
  container_name: zakupai-n8n
  ports:
    - "5678:5678"
  volumes:
    - n8n_data:/home/node/.n8n
    - ./n8n-nodes:/opt/n8n-nodes:ro
  environment:
    - GENERIC_TIMEZONE=Asia/Almaty
    - N8N_BASIC_AUTH_ACTIVE=false
    - ZAKUPAI_API_KEY=${ZAKUPAI_API_KEY}
    - N8N_CUSTOM_EXTENSIONS=/opt/n8n-nodes
  networks:
    - ai-network
    - zakupai-network
```

**Flowise service Ğ² docker-compose.yml:**

```yaml
flowise:
  image: flowiseai/flowise
  container_name: zakupai-flowise
  ports:
    - "3000:3000"
  volumes:
    - flowise_data:/root/.flowise
    - ./flowise-tools:/opt/flowise_tools:ro
  environment:
    - FLOWISE_USERNAME=admin
    - FLOWISE_PASSWORD=admin123
    - ZAKUPAI_API_KEY=${ZAKUPAI_API_KEY}
    - CUSTOM_TOOL_PATH=/opt/flowise_tools
  networks:
    - ai-network
    - zakupai-network
```

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° custom nodes

```bash
# n8n custom nodes
cd n8n-nodes
npm install
npm run build
npm link

# Ğ’ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğµ n8n
npm link zakupai-n8n-nodes

# Flowise custom tools
cd flowise-tools
npm install
npm run build
```

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ workflow

```javascript
// ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ n8n workflows
const prometheus = require('prom-client');

const workflowExecutions = new prometheus.Counter({
    name: 'n8n_workflow_executions_total',
    help: 'Total number of workflow executions',
    labelNames: ['workflow_name', 'status']
});

const workflowDuration = new prometheus.Histogram({
    name: 'n8n_workflow_duration_seconds',
    help: 'Workflow execution duration',
    labelNames: ['workflow_name']
});
```

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…

```json
{
  "name": "Error Notification Workflow",
  "trigger": {
    "type": "webhook",
    "path": "/error-webhook"
  },
  "nodes": [
    {
      "type": "telegram",
      "parameters": {
        "chatId": "@zakupai_admin",
        "text": "ğŸš¨ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² workflow:\n\nWorkflow: {{ $json.workflow_name }}\nĞÑˆĞ¸Ğ±ĞºĞ°: {{ $json.error_message }}\nĞ’Ñ€ĞµĞ¼Ñ: {{ $json.timestamp }}"
      }
    }
  ]
}
```

## Best Practices

### 1. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

```javascript
// Ğ’ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ custom node
try {
    // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
} catch (error) {
    if (this.continueOnFail()) {
        return [{ json: { error: error.message, timestamp: new Date().toISOString() } }];
    } else {
        throw error;
    }
}
```

### 2. ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```javascript
// ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ² Redis
const redis = require('redis');
const client = redis.createClient();

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºÑÑˆ Ğ¿ĞµÑ€ĞµĞ´ API Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼
const cacheKey = `lot_data_${lotId}`;
const cached = await client.get(cacheKey);

if (cached) {
    return JSON.parse(cached);
}

// Ğ”ĞµĞ»Ğ°ĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¸ ĞºÑÑˆĞ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ° 1 Ñ‡Ğ°Ñ
const data = await fetchLotData(lotId);
await client.setex(cacheKey, 3600, JSON.stringify(data));
```

### 3. Rate limiting

```javascript
// Rate limiting Ğ´Ğ»Ñ external API
const RateLimiter = require('limiter').RateLimiter;
const limiter = new RateLimiter(10, 'minute'); // 10 requests per minute

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² node
await new Promise(resolve => limiter.removeTokens(1, resolve));
// Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
```

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ n8n Ğ¸ Flowise Ñ ZakupAI Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚:

- âœ… **Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** - ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ workflow Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- âœ… **AI-Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ** - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ LLM Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ‚ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ²
- âœ… **Custom nodes Ğ¸ tools** - ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ³Ğ¾ÑĞ·Ğ°ĞºÑƒĞ¿Ğ¾Ğº
- âœ… **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ workflow** - Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- âœ… **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - Ğ»ĞµĞ³ĞºĞ¾Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑƒĞ·Ğ»Ğ¾Ğ² Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
- âœ… **Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** - Ğ¾Ñ‚ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ»Ğ¾Ñ‚Ğ¾Ğ² Ğ´Ğ¾ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
