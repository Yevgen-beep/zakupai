# ‚úÖ –†–ï–®–ï–ù–ò–ï: Gateway + Web –¥–ª—è ZakupAI

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

- **http://localhost:8080/attachments** —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö React –º–∞—Ä—à—Ä—É—Ç–æ–≤ —á–µ—Ä–µ–∑ Nginx gateway
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è, HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `gateway/nginx.conf` - –ü–û–õ–ù–û–°–¢–¨–Æ –û–ë–ù–û–í–õ–Å–ù

```nginx
# –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏
- SPA fallback –¥–ª—è React Router (/attachments, /suppliers, etc)
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (CSS, JS)
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è HTML —Å—Ç—Ä–∞–Ω–∏—Ü
- Rate limiting: API (60/min), Web (200/min)
- Gzip —Å–∂–∞—Ç–∏–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è FastAPI
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫—Ä–∞—Å–∏–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
```

### 2. `docker-compose.yml` - –°–µ–∫—Ü–∏–∏ `web` –∏ `gateway`

```yaml
web:
  # –î–æ–±–∞–≤–ª–µ–Ω—ã healthcheck –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:8000/health"]

gateway:
  # –î–æ–∂–∏–¥–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ web —Å–µ—Ä–≤–∏—Å–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
  depends_on:
    web:
      condition: service_healthy
```

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë
docker compose down

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker compose up -d --build

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
curl http://localhost:8080/attachments
```

## üîç –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ nginx.conf

### –ü–æ—á–µ–º—É location / –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç /attachments?

```nginx
location / {
  # –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã, –ù–ï –ø–æ–ø–∞–≤—à–∏–µ –≤ /calc/, /risk/, /static/, /api/
  # –ø–æ–ø–∞–¥–∞—é—Ç —Å—é–¥–∞, –≤–∫–ª—é—á–∞—è /attachments, /upload, /lot/123
  proxy_pass http://web;
}
```

### –ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω @spa_fallback?

```nginx
error_page 404 = @spa_fallback;

location @spa_fallback {
  # –ï—Å–ª–∏ backend –≤–µ—Ä–Ω—É–ª 404 –¥–ª—è /some/route
  # –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è React Router
  proxy_pass http://web/;
}
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: —á—Ç–æ –∏ –ø–æ—á–µ–º—É?

```nginx
# ‚úÖ –ö–≠–®–ò–†–£–ï–ú: CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ)
location /static/ {
  proxy_cache static;
  expires 1h;
}

# ‚ùå –ù–ï –ö–≠–®–ò–†–£–ï–ú: HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
location / {
  proxy_cache off;
  add_header Cache-Control "no-cache";
}
```

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å:

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–∞—Ä—à—Ä—É—Ç—ã (—á–µ—Ä–µ–∑ gateway:8080)

- ‚úÖ http://localhost:8080/ - –≥–ª–∞–≤–Ω–∞—è
- ‚úÖ http://localhost:8080/attachments - OCR –¥–æ–∫—É–º–µ–Ω—Ç—ã
- ‚úÖ http://localhost:8080/upload - –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–π—Å–æ–≤
- ‚úÖ http://localhost:8080/lot/123 - –∞–Ω–∞–ª–∏–∑ –ª–æ—Ç–∞

### API –º–∞—Ä—à—Ä—É—Ç—ã (—á–µ—Ä–µ–∑ gateway:8080)

- ‚úÖ http://localhost:8080/api/lot/123 - FastAPI endpoints
- ‚úÖ http://localhost:8080/calc/health - –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ http://localhost:8080/static/style.css - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

- üîß http://localhost:8082/attachments - web –Ω–∞–ø—Ä—è–º—É—é

## üõ† Troubleshooting

### –ï—Å–ª–∏ /attachments –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ gateway
docker compose logs gateway -f

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É web –Ω–∞–ø—Ä—è–º—É—é
curl -I http://localhost:8082/attachments

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker compose exec gateway nginx -t
```

### –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞
docker compose logs web -f

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check
curl http://localhost:8080/health

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
curl -I http://localhost:8080/static/bootstrap.min.css
```

## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

### 1. –ü–æ–¥–¥–æ–º–µ–Ω—ã –≤–º–µ—Å—Ç–æ –ø—É—Ç–µ–π:

```nginx
server_name api.zakupai.local;   # –¥–ª—è /calc/, /risk/
server_name app.zakupai.local;   # –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```

### 2. –ú–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã:

```nginx
location /admin/ { proxy_pass http://admin-frontend:3000; }
location /dashboard/ { proxy_pass http://dashboard-frontend:3001; }
```

### 3. SSL + HTTP/2:

```nginx
listen 443 ssl http2;
ssl_certificate /etc/ssl/certs/zakupai.crt;
ssl_certificate_key /etc/ssl/private/zakupai.key;
```

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

**üéâ –†–ê–ë–û–¢–ê–ï–¢!** –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

1. **http://localhost:8080/attachments** –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É OCR –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
1. React Router —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
1. API –≤—ã–∑–æ–≤—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π gateway
1. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
1. –ù–µ—Ç 404 –æ—à–∏–±–æ–∫ –¥–ª—è SPA –º–∞—Ä—à—Ä—É—Ç–æ–≤

–¢–µ–ø–µ—Ä—å ZakupAI –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –ø–æ—Ä—Ç 8080 —Å–æ –≤—Å–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é! üöÄ
