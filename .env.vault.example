# ===========================================
# ZakupAI Vault Integration Configuration
# ===========================================
# This file contains Vault-specific configuration and AppRole credentials
# Copy to .env.vault and fill in actual values from vault setup scripts
#
# SECURITY WARNING:
# - .env.vault is gitignored and should NEVER be committed
# - AppRole SECRET_IDs should be treated as highly sensitive
# - Rotate SECRET_IDs weekly using vault/scripts/rotate-secrets.sh
# - Store production credentials in secure vault or secrets manager

# ===========================================
# üîê VAULT CONNECTION
# ===========================================

# Vault server address
VAULT_ADDR=http://vault:8200
# Production: https://vault.zakupai.site

# Enable Vault integration
VAULT_ENABLED=true
# Set to false for local development without Vault

# Enable fallback to .env if Vault unavailable
VAULT_FALLBACK=true
# Recommended: true for development, false for production

# KV v2 mount point for ZakupAI secrets
VAULT_KV_MOUNT=zakupai

# Skip TLS verification (development only!)
VAULT_SKIP_VERIFY=false
# Set to true only for dev with self-signed certs

# CA certificate path (if using custom CA)
# VAULT_CACERT=/path/to/ca.crt

# Vault namespace (Enterprise feature)
# VAULT_NAMESPACE=zakupai

# ===========================================
# üé≠ APPROLE CREDENTIALS
# ===========================================
# Generated by: vault/scripts/setup-approles.sh
# Rotate weekly with: vault/scripts/rotate-secrets.sh

# ETL Service
VAULT_ETL_SERVICE_ROLE_ID=your-etl-service-role-id-here
VAULT_ETL_SERVICE_SECRET_ID=your-etl-service-secret-id-here
# Example:
# VAULT_ETL_SERVICE_ROLE_ID=8a7f4c2e-1b3d-4e5f-9a0b-c1d2e3f4a5b6
# VAULT_ETL_SERVICE_SECRET_ID=1234abcd-5678-efgh-9012-ijkl3456mnop

# Calc Service
VAULT_CALC_SERVICE_ROLE_ID=your-calc-service-role-id-here
VAULT_CALC_SERVICE_SECRET_ID=your-calc-service-secret-id-here

# Risk Engine
VAULT_RISK_ENGINE_ROLE_ID=your-risk-engine-role-id-here
VAULT_RISK_ENGINE_SECRET_ID=your-risk-engine-secret-id-here

# Telegram Bot
VAULT_TELEGRAM_BOT_ROLE_ID=your-telegram-bot-role-id-here
VAULT_TELEGRAM_BOT_SECRET_ID=your-telegram-bot-secret-id-here

# Admin (for migrations and operations)
VAULT_ADMIN_ROLE_ID=your-admin-role-id-here
VAULT_ADMIN_SECRET_ID=your-admin-secret-id-here

# ===========================================
# üîë DEVELOPMENT FALLBACK (Token Auth)
# ===========================================
# Use root token for local development only
# NEVER use in staging/production!

# Vault root token (from vault/data/init.json)
# VAULT_TOKEN=hvs.your-root-token-here

# Or token file path
# VAULT_TOKEN_FILE=/vault/data/.vault-token

# ===========================================
# üìä MONITORING & DEBUGGING
# ===========================================

# Vault client debug logging
VAULT_DEBUG=false
# Set to true to see detailed HVAC client logs

# Vault cache TTL (seconds)
VAULT_CACHE_TTL=300
# How long to cache secrets locally (default: 5 minutes)

# Token renewal threshold (seconds)
VAULT_RENEWAL_THRESHOLD=60
# Renew token when TTL drops below this (default: 1 minute)

# ===========================================
# üöÄ OBTAINING CREDENTIALS
# ===========================================
#
# 1. Start Vault:
#    docker-compose up -d vault
#
# 2. Initialize and setup AppRoles:
#    export VAULT_ADDR=http://localhost:8200
#    export VAULT_TOKEN=$(jq -r '.root_token' vault/data/init.json)
#    docker-compose exec vault /vault/scripts/init-vault.sh
#    docker-compose exec vault /vault/scripts/setup-approles.sh
#
# 3. Copy credentials:
#    docker-compose exec vault cat /vault/data/approle-credentials.env > .env.vault
#
# 4. Secure the file:
#    chmod 600 .env.vault
#
# 5. Verify gitignore:
#    git check-ignore .env.vault  # Should return: .env.vault
#
# ===========================================
# üìã SECRETS IN VAULT
# ===========================================
#
# Once Vault is configured, your application secrets are stored at:
#
# zakupai/shared/db              # PostgreSQL credentials
# zakupai/shared/redis           # Redis connection
# zakupai/shared/jwt             # JWT signing keys
# zakupai/shared/goszakup        # Government API token
# zakupai/shared/n8n             # n8n workflow automation
# zakupai/shared/flowise         # Flowise AI workflows
# zakupai/services/etl/openai    # OpenAI API key
# zakupai/services/etl/telegram  # Telegram bot token
# zakupai/services/calc/config   # Calc service config
# zakupai/services/risk/config   # Risk engine config
# zakupai/backup/b2              # Backblaze B2 credentials
#
# Migrate secrets with:
#    docker-compose exec vault /vault/scripts/migrate-secrets.sh
#
# ===========================================
# üîÑ ROTATION SCHEDULE
# ===========================================
#
# Recommended rotation schedule:
#
# - AppRole SECRET_IDs: Weekly (automated)
#   Command: docker-compose exec vault /vault/scripts/rotate-secrets.sh
#
# - JWT secrets: Monthly (manual, invalidates sessions)
#   Command: docker-compose exec vault /vault/scripts/rotate-secrets.sh --jwt
#
# - Database passwords: Quarterly (requires coordination)
#   1. Update in database
#   2. Update in Vault: vault kv put zakupai/shared/db POSTGRES_PASSWORD=new_pass
#   3. Restart services
#
# - API tokens: As recommended by provider
#   vault kv put zakupai/services/etl/openai OPENAI_API_KEY=new_key
#
# ===========================================
# ‚ö†Ô∏è SECURITY REMINDERS
# ===========================================
#
# ‚úÖ DO:
# - Keep .env.vault in .gitignore
# - Use AppRole auth in production
# - Rotate SECRET_IDs weekly
# - Monitor audit logs
# - Use Docker volumes for vault/data
# - Backup vault/data regularly
# - Test disaster recovery procedures
#
# ‚ùå DON'T:
# - Commit .env.vault to Git
# - Share SECRET_IDs between services
# - Use root token in production
# - Skip SECRET_ID rotation
# - Use bind mounts for vault/data
# - Ignore failed authentication attempts
# - Store backups unencrypted
#
# ===========================================
# üìö DOCUMENTATION
# ===========================================
#
# Full documentation:
# - docs/VAULT_INTEGRATION.md - Complete integration guide
# - vault/README.md - Vault setup and operations
# - vault/scripts/README.md - Script documentation
#
# Support:
# - Health check: curl http://localhost:7000/health | jq .vault
# - Audit log: tail -f vault/logs/audit.log
# - Vault status: docker-compose exec vault vault status
#
