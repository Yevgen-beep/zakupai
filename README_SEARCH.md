# ZakupAI Search v2 - –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –ª–æ—Ç–æ–≤

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –ª–æ—Ç–æ–≤ ZakupAI v2 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ì–æ—Å–∑–∞–∫—É–ø–æ–∫ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **GraphQL v2**, **GraphQL v3** –∏ **REST v3** —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ API –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### ‚ú® –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä API

- **–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Üí REST v3 (–±—ã—Å—Ç—Ä–µ–µ)
- **–°—Ä–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Üí GraphQL v2 (–±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π)
- **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Üí GraphQL v2 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

### üìä –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤

- –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (`–ª–∞–∫`, `—É–≥–æ–ª—å`, `–º–µ–±–µ–ª—å`)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ë–ò–ù –∑–∞–∫–∞–∑—á–∏–∫–∞
- –î–∏–∞–ø–∞–∑–æ–Ω—ã —Å—É–º–º (–æ—Ç-–¥–æ)
- –°–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–∫–∏ (—Ç–µ–Ω–¥–µ—Ä, –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –∏ –¥—Ä.)
- –°—Ç–∞—Ç—É—Å—ã –ª–æ—Ç–æ–≤ (–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω, –ø—Ä–∏–µ–º –∑–∞—è–≤–æ–∫, –∏ –¥—Ä.)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã (–¥–∞—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –æ–∫–æ–Ω—á–∞–Ω–∏—è)

### üîó –ì–æ—Ç–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- **Telegram –±–æ—Ç** —Å –Ω–æ–≤—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- **N8N workflows** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- **RESTful API** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bot/
‚îú‚îÄ‚îÄ search/                     # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ø–æ–∏—Å–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ graphql_v2_client.py   # GraphQL v2 –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ rest_v3_client.py      # REST/GraphQL v3 –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ search_service.py      # –ì–ª–∞–≤–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îî‚îÄ‚îÄ mappings.py            # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ ID ‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ services_v2.py             # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ handlers_v2.py             # –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram
tests/
‚îú‚îÄ‚îÄ test_graphql_search.py     # –¢–µ—Å—Ç—ã GraphQL v2
‚îú‚îÄ‚îÄ test_rest_search.py        # –¢–µ—Å—Ç—ã REST v3
‚îú‚îÄ‚îÄ test_fallback.py          # –¢–µ—Å—Ç—ã fallback –ª–æ–≥–∏–∫–∏
‚îî‚îÄ‚îÄ run_all_tests.py          # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install aiohttp asyncio
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# GraphQL v2 —Ç–æ–∫–µ–Ω (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π)
export GOSZAKUP_V2_TOKEN="–≤–∞—à_graphql_v2_—Ç–æ–∫–µ–Ω"

# REST v3 —Ç–æ–∫–µ–Ω (fallback)
export GOSZAKUP_V3_TOKEN="–≤–∞—à_rest_v3_—Ç–æ–∫–µ–Ω"

# –î–ª—è Telegram –±–æ—Ç–∞
export BOT_TOKEN="–≤–∞—à_telegram_bot_—Ç–æ–∫–µ–Ω"
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# config.py
class GoszakupConfig:
    v2_token = "–≤–∞—à_graphql_v2_—Ç–æ–∫–µ–Ω"
    v3_token = "–≤–∞—à_rest_v3_—Ç–æ–∫–µ–Ω"
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Python

```python
from bot.search import GoszakupSearchService, search_lots_for_telegram

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –æ–±–æ–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
service = GoszakupSearchService(
    graphql_v2_token="your_v2_token",
    rest_v3_token="your_v3_token"
)

# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
results = await service.search_by_keyword("–ª–∞–∫", limit=10)

# –°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
results = await service.search_complex(
    keyword="–º–µ–±–µ–ª—å",
    customer_bin="123456789012",
    trade_methods=["—Ç–µ–Ω–¥–µ—Ä", "–∫–æ–Ω–∫—É—Ä—Å"],
    min_amount=100000,
    max_amount=500000
)

# –ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Telegram
text = await search_lots_for_telegram("—É–≥–æ–ª—å", limit=5)
```

### Telegram –±–æ—Ç –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
/search –ª–∞–∫
/search –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –æ—Ñ–∏—Å–Ω—ã–µ
/search –º–µ–±–µ–ª—å –ë–ò–ù:123456789012
/search —É–≥–æ–ª—å —Å—É–º–º–∞:100000-500000

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
/search_advanced keyword=–∫–æ–º–ø—å—é—Ç–µ—Ä—ã min=50000 max=200000
/search_advanced bin=123456789012 method=—Ç–µ–Ω–¥–µ—Ä status=–ø—Ä–∏–µ–º

# –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ—Ç–∞
/lot LOT-123456789
/lot ANNO-987654321

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
/stats
```

### N8N Workflow

```json
{
  "webhook": "POST /goszakup-search",
  "graphql_request": {
    "url": "https://ows.goszakup.gov.kz/v2/graphql",
    "query": "query SearchLots($filter: LotsFiltersInput) { ... }",
    "variables": { "filter": { "nameRu": "{{$json.query}}" } }
  },
  "fallback_rest": {
    "url": "https://ows.goszakup.gov.kz/v3/lots",
    "params": { "nameRu": "{{$json.query}}", "limit": 10 }
  }
}
```

## üìã API Reference

### GoszakupSearchService

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
service = GoszakupSearchService(
    graphql_v2_token: Optional[str] = None,
    rest_v3_token: Optional[str] = None,
    default_strategy: SearchStrategy = SearchStrategy.AUTO
)
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**search_lots(query, strategy=None, limit=10)**

- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —Å –∞–≤—Ç–æ–≤—ã–±–æ—Ä–æ–º API

**search_by_keyword(keyword, limit=10)**

- –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É

**search_complex(keyword=None, customer_bin=None, ...)**

- –°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**get_lot_by_number(lot_number)**

- –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ—Ç–∞ –ø–æ –Ω–æ–º–µ—Ä—É

**format_results_for_telegram(results, show_source=False)**

- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram –±–æ—Ç–∞

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞

```python
SearchStrategy.AUTO        # –ê–≤—Ç–æ–≤—ã–±–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
SearchStrategy.GRAPHQL_V2  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ GraphQL v2
SearchStrategy.REST_V3     # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ REST v3
SearchStrategy.GRAPHQL_V3  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ GraphQL v3
```

### –§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞

#### GraphQL v2 (LotsFiltersInput)

```python
{
    "nameRu": "–ª–∞–∫",                    # –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
    "nameDescriptionRu": "–∫—Ä–∞—Å–∫–∞",      # –ü–æ–∏—Å–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–∏
    "customerBin": "123456789012",      # –ë–ò–ù –∑–∞–∫–∞–∑—á–∏–∫–∞
    "customerNameRu": "–¢–û–û –ö–æ–º–ø–∞–Ω–∏—è",   # –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫–∞
    "refTradeMethodsId": [1, 3, 7],     # –°–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–∫–∏
    "refLotStatusId": [1, 2, 10],       # –°—Ç–∞—Ç—É—Å—ã –ª–æ—Ç–æ–≤
    "trdBuyNumberAnno": "ANNO-001",     # –ù–æ–º–µ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    "amount": [100000],                 # –°—É–º–º—ã (—Å–ø–∏—Å–æ–∫)
    "lastUpdateDate": ["2024-01-01"]    # –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

#### REST v3

```python
{
    "nameRu": "–ª–∞–∫",                    # –ù–∞–∑–≤–∞–Ω–∏–µ
    "descriptionRu": "–∫—Ä–∞—Å–∫–∞",          # –û–ø–∏—Å–∞–Ω–∏–µ
    "customerBin": "123456789012",      # –ë–ò–ù –∑–∞–∫–∞–∑—á–∏–∫–∞
    "amountFrom": 100000,               # –°—É–º–º–∞ –æ—Ç
    "amountTo": 500000,                 # –°—É–º–º–∞ –¥–æ
    "publishDateFrom": "2024-01-01",    # –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç
    "publishDateTo": "2024-12-31",      # –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ
    "refTradeMethodsId": "1,3,7"        # –°–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–∫–∏ (—Å—Ç—Ä–æ–∫–∞)
}
```

## üóÇÔ∏è –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏

### –°–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–∫–∏ (ref_trade_methods)

```python
1  -> "–û—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–Ω–¥–µ—Ä"
2  -> "–ö–æ–Ω–∫—É—Ä—Å –ø–æ –∑–∞—è–≤–∫–∞–º"
3  -> "–ò–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞"
4  -> "–ó–∞–ø—Ä–æ—Å —Ü–µ–Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π"
7  -> "–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–Ω–∫—É—Ä—Å"
10 -> "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω"
```

### –°—Ç–∞—Ç—É—Å—ã –ª–æ—Ç–æ–≤ (ref_lot_status)

```python
1  -> "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω"
2  -> "–ü—Ä–∏–µ–º –∑–∞—è–≤–æ–∫"
3  -> "–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫"
4  -> "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è"
5  -> "–ó–∞–≤–µ—Ä—à–µ–Ω"
6  -> "–û—Ç–º–µ–Ω–µ–Ω"
10 -> "–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫"
11 -> "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
cd tests
python run_all_tests.py
```

### –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
# GraphQL v2 —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω)
export GOSZAKUP_V2_TOKEN="your_token"
python test_graphql_search.py

# REST v3 —Ç–µ—Å—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ —Ç–æ–∫–µ–Ω–∞)
python test_rest_search.py

# Fallback –ª–æ–≥–∏–∫–∞
python test_fallback.py
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
# –° —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
export GOSZAKUP_V2_TOKEN="real_v2_token"
export GOSZAKUP_V3_TOKEN="real_v3_token"
python run_all_tests.py
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```python
service = GoszakupSearchService(...)
stats = service.get_search_statistics()

print(f"GraphQL v2 –∑–∞–ø—Ä–æ—Å–æ–≤: {stats['v2_requests']}")
print(f"REST v3 –∑–∞–ø—Ä–æ—Å–æ–≤: {stats['v3_rest_requests']}")
print(f"Fallback —Å–ª—É—á–∞–µ–≤: {stats['fallback_requests']}")
print(f"–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: {stats['success_rate']*100:.1f}%")
```

### Telegram —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```bash
/stats  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## üîÑ Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ API

1. **–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å** (—Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ):

   - REST v3 ‚Üí –ë—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

1. **–£–º–µ—Ä–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å** (2-3 —Ñ–∏–ª—å—Ç—Ä–∞):

   - GraphQL v2 (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) ‚Üí –ë–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
   - REST v3 (fallback) ‚Üí –ù–∞–¥–µ–∂–Ω—ã–π –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç

1. **–°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å** (4+ —Ñ–∏–ª—å—Ç—Ä–æ–≤):

   - GraphQL v2 (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) ‚Üí –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å
   - GraphQL v3 (fallback) ‚Üí –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
   - REST v3 (–ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å) ‚Üí –ë–∞–∑–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
try:
    results = await service.search_lots("–ª–∞–∫")
except Exception as e:
    if "authorization" in str(e).lower():
        # –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–æ–º - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å
    elif "timeout" in str(e).lower():
        # –¢–∞–π–º–∞—É—Ç - –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ
    else:
        # –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å fallback
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 1. –ü–æ–∏—Å–∫ –ª–∞–∫–æ–∫—Ä–∞—Å–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

```python
# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
results = await service.search_by_keyword("–ª–∞–∫")

# –° –ë–ò–ù –∑–∞–∫–∞–∑—á–∏–∫–∞
results = await service.search_complex(
    keyword="–ª–∞–∫ –∫—Ä–∞—Å–∫–∞",
    customer_bin="123456789012"
)

# –í –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —Ü–µ–Ω–æ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
results = await service.search_complex(
    keyword="–ª–∞–∫–æ–∫—Ä–∞—Å–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
    min_amount=50000,
    max_amount=200000
)
```

### 2. –ü–æ–∏—Å–∫ –æ—Ñ–∏—Å–Ω–æ–π –º–µ–±–µ–ª–∏

```python
results = await service.search_complex(
    keyword="–º–µ–±–µ–ª—å –æ—Ñ–∏—Å–Ω–∞—è",
    trade_methods=["–û—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–Ω–¥–µ—Ä", "–ö–æ–Ω–∫—É—Ä—Å"],
    statuses=["–ü—Ä–∏–µ–º –∑–∞—è–≤–æ–∫", "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω"],
    min_amount=100000
)
```

### 3. –ü–æ–∏—Å–∫ —É–≥–ª—è –¥–ª—è –æ—Ç–æ–ø–ª–µ–Ω–∏—è

```python
results = await service.search_complex(
    keyword="—É–≥–æ–ª—å –∫–∞–º–µ–Ω–Ω—ã–π",
    min_amount=500000,
    max_amount=2000000,
    trade_methods=["–û—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–Ω–¥–µ—Ä"]
)
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### –ë—ã—Å—Ç—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥
from bot.services import goszakup_service
lots = await goszakup_service.search_lots("–ª–∞–∫")

# –ù–æ–≤—ã–π –∫–æ–¥ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
from bot.services_v2 import goszakup_service
lots = await goszakup_service.search_lots("–ª–∞–∫")  # –†–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ!
```

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

```python
# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (–Ω–æ–≤–æ–µ)
lots = await goszakup_service.search_lots_advanced(
    keyword="–º–µ–±–µ–ª—å",
    customer_bin="123456789012",
    min_amount=100000
)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–Ω–æ–≤–æ–µ)
stats = goszakup_service.get_search_statistics()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API (–Ω–æ–≤–æ–µ)
if goszakup_service.is_v2_available():
    print("GraphQL v2 –¥–æ—Å—Ç—É–ø–µ–Ω!")
```

## üö¶ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### üü¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SearchStrategy.AUTO` –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –æ–±–∞ —Ç–æ–∫–µ–Ω–∞ (v2 –∏ v3) –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `limit=10-20` –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üü° –û—Å—Ç–æ—Ä–æ–∂–Ω–æ

- –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `limit > 100` –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–∏–º–∏—Ç–∞–º–∏ —Ç–æ–∫–µ–Ω–æ–≤
- GraphQL v2 –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### üî¥ –ò–∑–±–µ–≥–∞—Ç—å

- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ API –±–µ–∑ fallback
- –ñ–µ—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑ —É—á–µ—Ç–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ø–æ–º–æ—â—å

### üí¨ –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ö–∞–∫–æ–π —Ç–æ–∫–µ–Ω –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
A: –û–±–∞! GraphQL v2 –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, REST v3 –∫–∞–∫ fallback.

**Q: –ß—Ç–æ –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?**
A: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–π API.

**Q: –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã?**
A: –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É goszakup.gov.kz

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤?**
A: –ß–∞—Å—Ç–∏—á–Ω–æ - —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ endpoints REST v3.

### üêõ –û—Ç—á–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `python tests/run_all_tests.py`
1. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏ —Å —É—Ä–æ–≤–Ω–µ–º DEBUG
1. –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é —Ç–æ–∫–µ–Ω–æ–≤ –∏ —É—Å–ª–æ–≤–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ zakupai.kz/support

### üìà Roadmap

- [ ] WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ—Ç–æ–≤
- [ ] ML-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ª–æ—Ç–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Elasticsearch –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] API rate limiting –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GraphQL subscriptions

______________________________________________________________________

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–°–∏—Å—Ç–µ–º–∞ ZakupAI Search v2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã: `export GOSZAKUP_V2_TOKEN=...`
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `python tests/run_all_tests.py`
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–¥–µ: `from bot.search import GoszakupSearchService`
1. –î–ª—è Telegram –±–æ—Ç–∞: –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `handlers_v2.py`

**–£–¥–∞—á–∏ –≤ —Ä–∞–±–æ—Ç–µ —Å –≥–æ—Å–∑–∞–∫—É–ø–∫–∞–º–∏! üöÄ**
