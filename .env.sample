# ZakupAI database configuration sample
# Перенеси файл в .env и дополни персональными значениями.
# Каждый сервис использует fallback: DATABASE_URL=${SERVICE_DB_URL:-${DATABASE_URL}}

# Единые креды для PostgreSQL (должны совпадать с docker-compose.yml)
POSTGRES_USER=zakupai
POSTGRES_PASSWORD=zakupai
POSTGRES_DB=zakupai

# Общая база (используется, если не задан сервисный URL)
DATABASE_URL=postgresql+psycopg2://${POSTGRES_USER}:${POSTGRES_PASSWORD}@zakupai-db:5432/${POSTGRES_DB}

# Персональные URL сервисов (все используют общую базу для упрощения)
BILLING_DB_URL=${DATABASE_URL}
CALC_DB_URL=${DATABASE_URL}
DOC_DB_URL=${DATABASE_URL}
EMBEDDING_DB_URL=${DATABASE_URL}
ETL_DB_URL=${DATABASE_URL}
RISK_DB_URL=${DATABASE_URL}

# Настройки для Alembic миграций
MIGRATIONS_DRY_RUN=true  # Dry-run по умолчанию для prod

# Использование в alembic.ini каждого сервиса:
# sqlalchemy.url = driver://user:pass@localhost/dbname
# А в migrations/env.py:
# config.set_main_option("sqlalchemy.url", os.getenv("DATABASE_URL"))

# Stage6 migration runners будут использовать:
# - DATABASE_URL=${BILLING_DB_URL:-${DATABASE_URL}} для billing-service
# - DATABASE_URL=${CALC_DB_URL:-${DATABASE_URL}} для calc-service
# - DATABASE_URL=${DOC_DB_URL:-${DATABASE_URL}} для doc-service
# - DATABASE_URL=${EMBEDDING_DB_URL:-${DATABASE_URL}} для embedding-api
# - DATABASE_URL=${ETL_DB_URL:-${DATABASE_URL}} для etl-service
# - DATABASE_URL=${RISK_DB_URL:-${DATABASE_URL}} для risk-engine
