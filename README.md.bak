[![CI](https://github.com/Yevgen-beep/zakupai/actions/workflows/ci.yml/badge.svg)](https://github.com/Yevgen-beep/zakupai/actions/workflows/ci.yml)

# ZakupAI

MVP-ะฟะปะฐััะพัะผะฐ ะดะปั ะฐะฒัะพะผะฐัะธะทะฐัะธะธ ะณะพัะทะฐะบัะฟะพะบ ะะ.
ZakupAI ะฐะฝะฐะปะธะทะธััะตั ัะตะฝะดะตัั, ะณะตะฝะตัะธััะตั ะบัะฐัะบะธะต TL;DR, ะพัะตะฝะธะฒะฐะตั ัะธัะบะธ ะธ ะผะฐัะถะธะฝะฐะปัะฝะพััั, ัะพัะผะธััะตั ะดะพะบัะผะตะฝัั ะธ ะถะฐะปะพะฑั, ะฐ ัะฐะบะถะต ะธะฝัะตะณัะธััะตััั ั n8n, Flowise ะธ Telegram-ะฑะพัะพะผ ะดะปั ะฑะธะทะฝะตัะฐ.

______________________________________________________________________

## ๐ ะะพะทะผะพะถะฝะพััะธ

- ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฐะทะฑะพั ัะตะฝะดะตัะพะฒ (TL;DR, ัะธัะบ-ัะบะพัะธะฝะณ, ะผะฐัะถะฐ, ะะะก, ัััะฐัั)
- ะะตะฝะตัะฐัะธั ะดะพะบัะผะตะฝัะพะฒ: ะฟะธััะผะฐ, ะถะฐะปะพะฑั, ะพััััั (PDF/HTML)
- **๐ ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ะฟะพะธัะบ ะปะพัะพะฒ** ั GraphQL v2 ะธ REST v3 API
- **๐ ะกะธััะตะผะฐ ะปะพะณะธัะพะฒะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน** ั ะฐะฒัะพะพัะธััะบะพะน ะธ ะฐะฝะฐะปะธัะธะบะพะน
- **๐ ะะฐััะธัะตะฝะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ ะธ ะผะตััะธะบะธ** โ ะพััะปะตะถะธะฒะฐะฝะธะต ะฟะพะฟัะปััะฝัั ะทะฐะฟัะพัะพะฒ, ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะน ะฐะบัะธะฒะฝะพััะธ
- **๐ ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ ะฑะฐะทั ะดะฐะฝะฝัั** โ ะธะฝัะตะปะปะตะบััะฐะปัะฝะฐั ัะพัะฐัะธั ะปะพะณะพะฒ ะฟะพ ะฒัะตะผะตะฝะธ ะธ ัะฐะทะผะตัั
- Telegram-ะฑะพั @TenderFinderBot_bot ะบะฐะบ ะพัะฝะพะฒะฝะพะน ะธะฝัะตััะตะนั ะดะปั ะะกะ
- ะะฝัะตะณัะฐัะธะธ: Flowise (ะฒะธะทัะฐะปัะฝัะต AI-ะฒะพัะบัะปะพั), n8n (ะฐะฒัะพะผะฐัะธะทะฐัะธั ะฟัะพัะตััะพะฒ)
- ะะพะฝะธัะพัะธะฝะณ ะบะพะฝะบััะตะฝัะพะฒ ะธ ยซะณะพัััะธะต ะปะพััยป (ัะฒะตะดะพะผะปะตะฝะธั ะฟะพ cron)
- ะคะธะฝะฐะฝัะพะฒัะน ะบะฐะปัะบัะปััะพั ะดะปั ะพัะตะฝะบะธ ะฒัะณะพะดะฝะพััะธ ััะฐััะธั

______________________________________________________________________

## ๐ ะััะธัะตะบัััะฐ

ZakupAI ะฟะพัััะพะตะฝ ะฝะฐ ะผะธะบัะพัะตัะฒะธัะฝะพะน ะฐััะธัะตะบัััะต (FastAPI + Docker).

### ะัะฝะพะฒะฝัะต ัะตัะฒะธัั

- **API Gateway** (`http://localhost:8080`) โ ะผะฐัััััะธะทะฐัะธั, rate limits, X-API-Key
- **Billing Service** (`:7004`) โ ัะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ, API ะบะปััะธ, ะปะธะผะธัั, ะฟะพะดะฟะธัะบะธ
- **Calc Service** (`:7001`) โ ัะฐััััั (ะะะก, ะผะฐัะถะฐ, ัััะฐัั)
- **Risk Engine** (`:7002`) โ ัะธัะบ-ัะบะพัะธะฝะณ ะธ ะพะฑัััะฝะตะฝะธั
- **Doc Service** (`:7003`) โ TL;DR, ะฟะธััะผะฐ, PDF-ัะบัะฟะพัั, ะปะพะบะฐะปะธะทะฐัะธั (ru/kz/en)
- **Embedding API** (`:7010`) โ ะฒะตะบัะพัะธะทะฐัะธั, ะฟะพะธัะบ, ะธะฝัะตะณัะฐัะธั ั Ollama

### ะะฐะทั ะดะฐะฝะฝัั

- **PostgreSQL** (`:5432`) โ ะปะพัั, ัะตะฝั, ัะธัะบะธ, ัะธะฝัะตะทัะปััะฐัั + billing ััะตะผะฐ (users, api_keys, usage, payments)
- **ChromaDB** (`:8000`) โ ะฒะตะบัะพัะฝะพะต ััะฐะฝะธะปะธัะต ะดะปั ะฟะพะธัะบะฐ

### ะะปะธะตะฝััะบะธะต ะธะฝัะตััะตะนัั

- **Telegram Bot** (@TenderFinderBot_bot)
  - `/start` โ ะฟัะธะฒะตัััะฒะธะต + ัะตะณะธัััะฐัะธั
  - `/key <API_KEY>` โ ะฟัะธะฒัะทะบะฐ ะบะปััะฐ
  - `/lot <id|url>` โ ะฟะพะปะฝัะน ะฐะฝะฐะปะธะท ะปะพัะฐ
  - `/search <ะทะฐะฟัะพั>` โ ะฟะพะธัะบ ะปะพัะพะฒ ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ
  - `/help` โ ัะฟัะฐะฒะบะฐ
  - **๐ ะะพะผะฐะฝะดั ะฐะฝะฐะปะธัะธะบะธ:**
    - `/analytics` โ ัะธััะตะผะฝะฐั ััะฐัะธััะธะบะฐ ะทะฐ 7 ะดะฝะตะน
    - `/popular` โ ัะพะฟ ะฟะพะฟัะปััะฝัั ะทะฐะฟัะพัะพะฒ
    - `/mystats` โ ะฟะตััะพะฝะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
  - **๐ ะะดะผะธะฝัะบะธะต ะบะพะผะฐะฝะดั:**
    - `/cleanup [ะดะฝะธ]` โ ะพัะธััะบะฐ ะปะพะณะพะฒ ััะฐััะต N ะดะฝะตะน
    - `/dbinfo` โ ะธะฝัะพัะผะฐัะธั ะพ ัะฐะทะผะตัะต ะธ ัะพััะพัะฝะธะธ ะฑะฐะทั ะดะฐะฝะฝัั
    - `/autocleanup [ัะฐะทะผะตั_MB]` โ ะฐะฒัะพะพัะธััะบะฐ ะฟัะธ ะฟัะตะฒััะตะฝะธะธ ัะฐะทะผะตัะฐ
- **Web UI** (`http://localhost:8082`) โ ะฟัะพัะผะพัั ะปะพัะพะฒ, ะทะฐะณััะทะบะฐ ะฟัะฐะนัะพะฒ (CSV/XLSX)
- **Flowise** (`http://localhost:3000`) โ AI-ะฒะพัะบัะปะพั (lot-reader, risk-explain, finance-calc, template-gen)
- **n8n** (`http://localhost:5678`) โ ะฐะฒัะพะผะฐัะธะทะฐัะธั ะธ ะฟะฐะนะฟะปะฐะนะฝั

### ะะพะฝะธัะพัะธะฝะณ ะธ DevOps

- **Prometheus** (`http://localhost:9090`) โ ะผะตััะธะบะธ ะธ ัะฐัะณะตัั
- **Grafana** (`http://localhost:3030`) โ ะดะฐัะฑะพัะดั ะธ ะฒะธะทัะฐะปะธะทะฐัะธั
- **Alertmanager** (`http://localhost:9093`) โ ัะฟัะฐะฒะปะตะฝะธะต ะฐะปะตััะฐะผะธ
- **Loki** (`http://localhost:3100`) โ ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
- **Promtail** โ ะฐะณะตะฝั ัะฑะพัะฐ ะปะพะณะพะฒ ั Docker ะบะพะฝัะตะนะฝะตัะพะฒ
- **cAdvisor** (`http://localhost:8081`) โ ะผะตััะธะบะธ ะบะพะฝัะตะนะฝะตัะพะฒ
- **Node Exporter** (`http://localhost:19100`) โ ะผะตััะธะบะธ ัะธััะตะผั
- **BlackBox Exporter** (`http://localhost:9115`) โ HTTP/TCP ะผะพะฝะธัะพัะธะฝะณ
- **๐ Monitoring Test Suite** โ ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะฐั ะฟัะพะฒะตัะบะฐ ะธะฝััะฐััััะบัััั ะผะพะฝะธัะพัะธะฝะณะฐ
- ะะฒัะพะฑัะบะฐะฟั PostgreSQL (pg_dump + rclone โ B2/S3)
- CI/CD (lint, build, smoke-ัะตััั, monitoring-ัะตััั)

### ๐ก๏ธ ะะตะทะพะฟะฐัะฝะพััั

**ะะพะฝัะธะณััะฐัะธั:**

- ะัะต ัะตะบัะตัั ะทะฐะณััะถะฐัััั ะธะท `.env` ัะฐะนะปะพะฒ (ะฟะฐัะพะปะธ, API ะบะปััะธ, ัะพะบะตะฝั)
- ะะฑัะทะฐัะตะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฒะฐะปะธะดะธัััััั ะฟัะธ ะทะฐะฟััะบะต
- ะะธะบะพะณะดะฐ ะฝะต ะปะพะณะธััะตะผ API ะบะปััะธ ะธะปะธ ะฟะฐัะพะปะธ (ัะพะปัะบะพ ะผะฐัะบะธัะพะฒะฐะฝะฝัะต ะฒะตััะธะธ)

**ะะฐะทะฐ ะดะฐะฝะฝัั:**

- Connection pooling ั ะพะณัะฐะฝะธัะตะฝะธัะผะธ (min/max ัะพะตะดะธะฝะตะฝะธั, ัะฐะนะผะฐััั)
- ะะฐัะฐะผะตััะธะทะพะฒะฐะฝะฝัะต SQL ะทะฐะฟัะพัั ะดะปั ะทะฐัะธัั ะพั ะธะฝัะตะบัะธะน
- ะะฐะปะธะดะฐัะธั ะฒัะพะดะฝัั ะดะฐะฝะฝัั ั ะฟะพะผะพััั Pydantic ะผะพะดะตะปะตะน
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะทะฐะบัััะธะต ัะพะตะดะธะฝะตะฝะธะน ัะตัะตะท ะบะพะฝัะตะบััะฝัะต ะผะตะฝะตะดะถะตัั

**HTTP ะธ API:**

- SSL verification ะฒะบะปััะตะฝ ะฟะพ ัะผะพะปัะฐะฝะธั ะดะปั ะฒัะตั ะฒะฝะตัะฝะธั ะทะฐะฟัะพัะพะฒ
- Request/Response ะปะพะณะธัะพะฒะฐะฝะธะต ั ัะฝะธะบะฐะปัะฝัะผะธ X-Request-Id
- ะขะฐะนะผะฐััั ะดะปั ะฒัะตั HTTP ะทะฐะฟัะพัะพะฒ (ะทะฐัะธัะฐ ะพั ะทะฐะฒะธัะฐะฝะธั)
- ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฑะตะท ััะตัะบะธ ัะตัะฝะธัะตัะบะธั ะดะตัะฐะปะตะน

**Telegram Bot:**

- Rate limiting: ะผะฐะบัะธะผัะผ 10 ะบะพะผะฐะฝะด ะฒ ะผะธะฝััั ะฝะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะฐะปะธะดะฐัะธั ะธ ัะฐะฝะธัะธะทะฐัะธั ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะฒะฒะพะดะพะฒ
- ะะตะทะพะฟะฐัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ URL ะธ ID ะปะพัะพะฒ (ะทะฐัะธัะฐ ะพั XSS)
- ะะพะณะธัะพะฒะฐะฝะธะต ัะพะฑััะธะน ะฑะตะทะพะฟะฐัะฝะพััะธ (ะฟัะตะฒััะตะฝะธั ะปะธะผะธัะพะฒ, ะฟะพะดะพะทัะธัะตะปัะฝัะต ะฒะฒะพะดั)

**ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั:**

- ะกััะพะณะฐั ัะธะฟะธะทะฐัะธั ั Pydantic ะดะปั ะฒัะตั API ะผะพะดะตะปะตะน
- ะะณัะฐะฝะธัะตะฝะธะต ัะฐะทะผะตัะพะฒ ะฒัะพะดะฝัั ะดะฐะฝะฝัั (ะทะฐัะธัะฐ ะพั DoS)
- Email ะฒะฐะปะธะดะฐัะธั ะฟะพ RFC ััะฐะฝะดะฐััะฐะผ
- UUID ัะพัะผะฐั ะดะปั API ะบะปััะตะน ั ะฟัะพะฒะตัะบะพะน

**Monitoring ะฑะตะทะพะฟะฐัะฝะพััะธ:**

- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั security events ั ััะพะฒะฝะตะผ WARNING
- ะััะปะตะถะธะฒะฐะฝะธะต ะฝะตัะดะฐัะฝัั ะฟะพะฟััะพะบ ะฐะฒัะพัะธะทะฐัะธะธ
- ะะพะฝะธัะพัะธะฝะณ ะฟัะตะฒััะตะฝะธะน rate limits
- ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฑะตะท ัะตะบัะตัะพะฒ

### AI ะธ Ollama

- **Ollama (host)** (`http://localhost:11434`)
- ะะพะดะตะปะธ: `qwen3`, `llama3`, `mistral`, `deepseek-r1`
- ะัะฟะพะปัะทัะตััั ะดะปั ัะผะฑะตะดะดะธะฝะณะพะฒ ะธ LLM-ะพะฑัะฐะฑะพัะบะธ

### ๐ ะกะธััะตะผะฐ ะฐะฝะฐะปะธัะธะบะธ ะธ ะผะตััะธะบ

**๐ ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ะผะตััะธะบะธ:**

- SQLite ะฑะฐะทะฐ ะดะฐะฝะฝัั ะดะปั ััะฐะฝะตะฝะธั ะปะพะณะพะฒ ะฟะพะธัะบะพะฒัั ะทะฐะฟัะพัะพะฒ
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน ะฟะพะธัะบะฐ ั ะฒัะตะผะตะฝะฝัะผะธ ะผะตัะบะฐะผะธ
- ะััะปะตะถะธะฒะฐะฝะธะต ััะฟะตัะฝะพััะธ ะทะฐะฟัะพัะพะฒ, ะฒัะตะผะตะฝะธ ะฒัะฟะพะปะฝะตะฝะธั, ะธัะฟะพะปัะทัะตะผัั API
- ะกัะฐัะธััะธะบะฐ ะฟะพ ะฟะพะปัะทะพะฒะฐัะตะปัะผ: ะบะพะปะธัะตััะฒะพ ะฟะพะธัะบะพะฒ, ัะฝะธะบะฐะปัะฝัะต ะทะฐะฟัะพัั, ัะฐััะพัะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

**๐ ะะฝะฐะปะธัะธัะตัะบะธะต ะฒะพะทะผะพะถะฝะพััะธ:**

- ะะพะฟัะปััะฝัะต ะฟะพะธัะบะพะฒัะต ะทะฐะฟัะพัั ะทะฐ ะปัะฑะพะน ะฟะตัะธะพะด (ัะพะฟ-10)
- ะกะธััะตะผะฝะฐั ััะฐัะธััะธะบะฐ: ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟะพะธัะบะพะฒ, ะฐะบัะธะฒะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ, ััะฟะตัะฝะพััั
- ะะตััะพะฝะฐะปัะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ: ะธะฝะดะธะฒะธะดัะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ ะบะฐะถะดะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะพะฝะธัะพัะธะฝะณ ะพัะธะฑะพะบ ะธ ะฟัะพะฑะปะตะผ ะฒ ะฟะพะธัะบะพะฒัั ะทะฐะฟัะพัะฐั
- ะะฝะฐะปะธะท ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ัะฐะทะปะธัะฝัั API (GraphQL v2 vs REST v3)

**๐ ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ ะฑะฐะทั ะดะฐะฝะฝัั:**

- ะะฝัะตะปะปะตะบััะฐะปัะฝะฐั ัะพัะฐัะธั ะปะพะณะพะฒ ะฝะฐ ะพัะฝะพะฒะต ะฒัะตะผะตะฝะธ ะธ ัะฐะทะผะตัะฐ ะฑะฐะทั
- ะกััะฐัะตะณะธะธ ะพัะธััะบะธ:
  - < 50 MB: ััะฐะฝะดะฐััะฝะฐั ะพัะธััะบะฐ (90 ะดะฝะตะน)
  - 50-100 MB: ัะผะตัะตะฝะฝะฐั ะพัะธััะบะฐ (60 ะดะฝะตะน)
  - \> 100 MB: ะฐะณัะตััะธะฒะฝะฐั ะพัะธััะบะฐ (30 ะดะฝะตะน)
- ะะฒัะพะผะฐัะธัะตัะบะฐั VACUUM ะพะฟัะธะผะธะทะฐัะธั ะดะปั ะพัะฒะพะฑะพะถะดะตะฝะธั ะดะธัะบะพะฒะพะณะพ ะฟัะพัััะฐะฝััะฒะฐ
- Cron ัะบัะธะฟั ะดะปั ะตะถะตะฝะตะดะตะปัะฝะพะน ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ

**๐ Telegram ะบะพะผะฐะฝะดั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ:**

- `/analytics` โ ัะธััะตะผะฝะฐั ััะฐัะธััะธะบะฐ ะทะฐ 7 ะดะฝะตะน
- `/popular [ะดะฝะธ]` โ ะฟะพะฟัะปััะฝัะต ะทะฐะฟัะพัั ะทะฐ ะฟะตัะธะพะด
- `/mystats [ะดะฝะธ]` โ ะฟะตััะพะฝะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- `/cleanup [ะดะฝะธ]` โ ัััะฝะฐั ะพัะธััะบะฐ ะปะพะณะพะฒ (ะฐะดะผะธะฝั)
- `/dbinfo` โ ะธะฝัะพัะผะฐัะธั ะพ ัะฐะทะผะตัะต ะธ ัะพััะพัะฝะธะธ ะฑะฐะทั (ะฐะดะผะธะฝั)
- `/autocleanup [ะะ]` โ ะฐะฒัะพะพัะธััะบะฐ ะฟัะธ ะฟัะตะฒััะตะฝะธะธ ัะฐะทะผะตัะฐ (ะฐะดะผะธะฝั)

**๐ ะคะฐะนะปั ัะธััะตะผั:**

- `bot/user_metrics.py` โ ะพัะฝะพะฒะฝะพะน ัะตัะฒะธั ะผะตััะธะบ ะธ ะพัะธััะบะธ
- `bot/analytics_service.py` โ ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ะพััะตัะพะฒ ะดะปั Telegram
- `cleanup_logs.py` โ ัะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ ัะตัะตะท cron
- `docs/modules/log-cleanup/LOG_CLEANUP.md` โ ะฟะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ัะธััะตะผั ะพัะธััะบะธ

______________________________________________________________________

### ๐ ะะพัะพะบะธ ะดะฐะฝะฝัั

````mermaid
flowchart LR
    TG[Telegram Bot] -->|/key /lot|
    B[Billing Service]
    W[Web UI] --> B
    F[โก Flowise] --> B
    N[n8n Workflows] --> B

    B --> G[API Gateway]

    G --> C[Calc Service]
    G --> R[Risk Engine]
    G --> D[Doc Service]
    G --> E[Embedding API]

    E --> O[Ollama (host)]
    G --> DB[(PostgreSQL)]
    E --> CH[(ChromaDB)]

๐ Billing Service
MVP (Stage)
PostgreSQL (ััะตะผะฐ billing):
users โ ะฟะพะปัะทะพะฒะฐัะตะปะธ
api_keys โ API-ะบะปััะธ ะธ ะฟะปะฐะฝั
usage โ ััะฐัะธััะธะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
payments โ ะพะฟะปะฐัั ะธ ะฟะพะดะฟะธัะบะธ

FastAPI endpoints:
POST /billing/create_key โ ัะพะทะดะฐัั API-ะบะปัั (ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ /start)
POST /billing/validate_key โ ะฒะฐะปะธะดะฐัะธั ะบะปััะฐ + ะฟัะพะฒะตัะบะฐ ะปะธะผะธัะพะฒ
POST /billing/usage โ ะปะพะณะธัะพะฒะฐะฝะธะต ะธัะฟะพะปัะทะพะฒะฐะฝะธั
GET /billing/stats/{tg_id} โ ััะฐัะธััะธะบะฐ ะฟะพ ะฟะพะปัะทะพะฒะฐัะตะปั

ะกะธััะตะผะฐ ะปะธะผะธัะพะฒ:
Free: 100 ะทะฐะฟัะพัะพะฒ/ะดะตะฝั, 20/ัะฐั
Premium: 5000 ะทะฐะฟัะพัะพะฒ/ะดะตะฝั, 500/ัะฐั
Docker: ัะตัะฒะธั ัะฐะฑะพัะฐะตั ะฝะฐ :7004, ะธะฝัะตะณัะธัะพะฒะฐะฝ ะฒ ะพะฑัะธะน docker-compose

ะขะฐัะธัั
ะะปะฐะฝ	                ะะธะผะธั ะฒ ะดะตะฝั	   ะะธะผะธั ะฒ ัะฐั	        ะฆะตะฝะฐ
Free	                    100	              20	            0 โธ
Premium	                  5000	            500	            10 000 โธ


ะะฝัะตะณัะฐัะธั
Telegram Bot: ะฒัะดะฐัั ะบะปััะธ ะธ ะฟัะพะฒะตััะตั ะธั ะฟะตัะตะด ะฐะฝะฐะปะธะทะพะผ ะปะพัะฐ
Gateway: ะฟัะพะฒะตััะตั ะบะปััะธ ะฟะตัะตะด ะดะพัััะฟะพะผ ะบ API
ะัะต ัะตัะฒะธัั ZakupAI: ัะฐะฑะพัะฐัั ัะพะปัะบะพ ัะตัะตะท Billing ะฒะฐะปะธะดะฐัะธั

ะกะฒะพะดะบะฐ ะฟะพ ะฟะพััะฐะผ
Gateway โ http://localhost:8080
Web UI โ http://localhost:8082 (ะธะฝัะตะณัะธัะพะฒะฐะฝ ั goszakup-api)
Telegram Bot โ @TenderFinderBot_bot
Flowise โ http://localhost:3000
n8n โ http://localhost:5678
Postgres โ :5432
ChromaDB โ :8000
Calc Service โ :7001
Risk Engine โ :7002
Doc Service โ :7003
Billing Service โ :7004
Goszakup API โ :7005 (ะฒะฝัััะตะฝะฝะธะน ัะตัะฒะธั ะดะปั ัะฐะฑะพัั ั ะะพัะะฐะบัะฟ)
ETL Service โ :7011 (ะพะฑัะฐะฑะพัะบะฐ ะดะพะบัะผะตะฝัะพะฒ ะธ OCR)
Embedding API โ :7010
Ollama (host) โ http://localhost:11434
Prometheus โ http://localhost:9090
Grafana โ http://localhost:3030
Alertmanager โ http://localhost:9093
Loki โ http://localhost:3100
cAdvisor โ http://localhost:8081
Node Exporter โ http://localhost:19100
BlackBox Exporter โ http://localhost:9115

Security & DevOps
Rate limits: 60 req/min (Nginx Gateway)
X-API-Key ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ
CORS/CSRF ะฟะพะปะธัะธะบะฐ: dev โ ะพัะบัััะฐั, stage โ ะพะณัะฐะฝะธัะตะฝะฝะฐั, prod โ ัััะพะณะฐั
ะะฐะปะธะดะฐัะธั ะฒัะพะดะฝัั ะดะฐะฝะฝัั (FastAPI deps)
Pre-commit ััะบะธ: ruff, black, isort, yamllint, mdformat
SAST (Bandit) ะฒ CI
ะะฒัะพะฑัะบะฐะฟั PostgreSQL (pg_dump + rclone โ B2/S3)

ะะพะฝะตัะธะทะฐัะธั
Freemium โ Premium ะฟะพะดะฟะธัะบะฐ (10 000 โธ/ะผะตั)
ะะฐะบะตัั ะดะพะบัะผะตะฝัะพะฒ (3 000โ10 000 โธ ะทะฐ ะบะพะผะฟะปะตะบั)
AI-ะพััััั PDF ะดะปั ะฐะฝะฐะปะธะทะฐ ัะตะฝะดะตัะพะฒ
White Label ะดะปั ััะธััะพะฒ ะธ ะบะพะฝัะฐะปัะธะฝะณะพะฒัั ะบะพะผะฟะฐะฝะธะน

ะะธะดั ะดะตััะตะปัะฝะพััะธ (ะะะญะ)
62.01.1 โ ะะฐะทัะฐะฑะพัะบะฐ ะะ ะธ SaaS (ะพัะฝะพะฒะฝะพะน)
62.01.2 โ ะะข-ะบะพะฝัะฐะปัะธะฝะณ, ะฒะฝะตะดัะตะฝะธะต ะะ
63.11.1 โ ะะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั, API ัะตัะฒะธัั
62.03.0 โ MLOps ะธ ะธะฝััะฐััััะบัััะฐ
62.09.0 โ ะะฝะฝะพะฒะฐัะธะพะฝะฝัะต IT-ัะตัะตะฝะธั

## ๐ ะัััััะน ะทะฐะฟััะบ

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั
```bash
# ะกะบะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone <repo_url>
cd zakupai

# ะกะบะพะฟะธัะพะฒะฐัั ะบะพะฝัะธะณััะฐัะธะพะฝะฝัะต ัะฐะนะปั
cp .env.example .env
cp bot/.env.example bot/.env

# ะะฐัััะพะนะบะฐ Goszakup API Token (ะพะฑัะทะฐัะตะปัะฝะพ ะดะปั Web UI)
# ะะพะปััะธัะต ัะพะบะตะฝ ะฝะฐ https://ows.goszakup.gov.kz
# ะะฑะฝะพะฒะธัะต GOSZAKUP_TOKEN ะฒ .env
````

### 2. ะะฐัััะพะนะบะฐ Telegram Bot (ะพะฑัะทะฐัะตะปัะฝะพ)

ะััะตะดะฐะบัะธััะนัะต ัะฐะนะป `bot/.env`:

```bash
# ะะพะปััะธัะต ัะพะบะตะฝ ะพั @BotFather ะฒ Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_here

# ะะปั ัะฐะทัะฐะฑะพัะบะธ (ะฟะพ ัะผะพะปัะฐะฝะธั)
ENVIRONMENT=development

# ะะปั production ะดะพะฑะฐะฒััะต webhook ะฝะฐัััะพะนะบะธ
TELEGRAM_WEBHOOK_URL=https://your-domain.com/webhook/telegram
TELEGRAM_WEBHOOK_SECRET=your_webhook_secret
```

### 3. ะะฐะฟััะบ ัะตัะฒะธัะพะฒ

```bash
# ะะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั
docker-compose up -d

# ะัะพะฒะตัะธัั ััะฐััั
docker-compose ps

# ะะพัะผะพััะตัั ะปะพะณะธ ะฑะพัะฐ
docker-compose logs -f zakupai-bot
```

### 4. ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

```bash
# ะัะพะฒะตัะธัั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฑะพัะฐ
docker exec zakupai-bot env | grep TELEGRAM

# ะัะพะฒะตัะธัั webhook (ะตัะปะธ ะฝะฐัััะพะตะฝ)
curl -s "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getWebhookInfo" | python3 -m json.tool

# ะัะพะฒะตัะธัั API Gateway
curl http://localhost:8080/health
```

### 5. ะขะตััะธัะพะฒะฐะฝะธะต ะฑะพัะฐ

1. ะะฐะนะดะธัะต ะฒะฐัะตะณะพ ะฑะพัะฐ ะฒ Telegram ะฟะพ ัะพะบะตะฝั
1. ะัะฟัะฐะฒััะต `/start`
1. ะะพะฟัะพะฑัะนัะต ะบะพะผะฐะฝะดั `/help`, `/search ะบะพะผะฟัััะตัั`

______________________________________________________________________

## ๐ ะะพะบัะผะตะฝัะฐัะธั ะฟะพ ะฝะฐัััะพะนะบะต

### ะะตะถะธะผั ัะฐะฑะพัั ะฑะพัะฐ

**Development (polling):**

- `ENVIRONMENT=development` ะฒ `bot/.env`
- ะะพั ัะฐะฑะพัะฐะตั ัะตัะตะท polling (ะทะฐะฟัะฐัะธะฒะฐะตั ะพะฑะฝะพะฒะปะตะฝะธั)
- ะะพะดัะพะดะธั ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ

**Production (webhook):**

- `ENVIRONMENT=production` ะธะปะธ `staging` ะฒ `bot/.env`
- ะะฐัััะพะนัะต `TELEGRAM_WEBHOOK_URL` ะธ `TELEGRAM_WEBHOOK_SECRET`
- Telegram ะพัะฟัะฐะฒะปัะตั ะพะฑะฝะพะฒะปะตะฝะธั ะฝะฐ ะฒะฐั ัะตัะฒะตั
- ะะพะปะตะต ัััะตะบัะธะฒะฝะพ ะดะปั production

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะัะฝะพะฒะฝัะต ัะฐะนะปั ะบะพะฝัะธะณััะฐัะธะธ:

- `.env` โ ะพะฑัะธะต ะฝะฐัััะพะนะบะธ (ะะ, API, ะผะพะฝะธัะพัะธะฝะณ)
- `bot/.env` โ ะฝะฐัััะพะนะบะธ Telegram ะฑะพัะฐ

**ะัะธัะธัะตัะบะธะต ะฟะตัะตะผะตะฝะฝัะต ะฒ bot/.env:**

```bash
TELEGRAM_BOT_TOKEN=       # ะขะพะบะตะฝ ะพั @BotFather
TELEGRAM_WEBHOOK_URL=     # URL ะดะปั webhook (production)
TELEGRAM_WEBHOOK_SECRET=  # ะกะตะบัะตั ะดะปั webhook (production)
ENVIRONMENT=              # development/staging/production
N8N_WEBHOOK_URL=         # URL n8n ะดะปั ะฟะพะธัะบะฐ ะปะพัะพะฒ
```

### ะฃัััะฐะฝะตะฝะธะต ะฟัะพะฑะปะตะผ

**ะะพั ะฝะต ะพัะฒะตัะฐะตั:**

```bash
# ะัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัะต
docker exec zakupai-bot env | grep TELEGRAM_BOT_TOKEN

# ะัะพะฒะตัััะต ะปะพะณะธ
docker-compose logs zakupai-bot

# ะะตัะตะทะฐะฟัััะธัะต ะฑะพัะฐ
docker-compose restart zakupai-bot
```

**ะัะธะฑะบะฐ "Missing required environment variables: TELEGRAM_BOT_TOKEN":**

- ะฃะฑะตะดะธัะตัั, ััะพ ัะฐะนะป `bot/.env` ัััะตััะฒัะตั
- ะัะพะฒะตัััะต, ััะพ ะฒ ะฝะตะผ ะตััั `TELEGRAM_BOT_TOKEN=ะฒะฐั_ัะพะบะตะฝ`
- ะะตัะตะทะฐะฟัััะธัะต ะบะพะฝัะตะนะฝะตั: `docker-compose restart zakupai-bot`

**ะะฐะทะฐ ะดะฐะฝะฝัั ะฝะตะดะพัััะฟะฝะฐ:**

```bash
# ะะฐะฟัััะธัะต ะะ ะพัะดะตะปัะฝะพ
docker-compose up -d db

# ะะพะถะดะธัะตัั ะณะพัะพะฒะฝะพััะธ (~30 ัะตะบัะฝะด)
docker-compose logs db

# ะะฐะฟัััะธัะต ะฑะพัะฐ
docker-compose up -d zakupai-bot
```

______________________________________________________________________

## Testing OCR & Search (Sprint 2)

ะ ะกะฟัะธะฝัะต 2 ัะตะฐะปะธะทะพะฒะฐะฝ ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝัะน OCR pipeline ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผะธ ะผะธะณัะฐัะธัะผะธ ะะ ะธ ะธะฝัะตะณัะฐัะธะตะน ChromaDB ะดะปั ัะตะผะฐะฝัะธัะตัะบะพะณะพ ะฟะพะธัะบะฐ. ะกะธััะตะผะฐ ะพะฑัะฐะฑะฐััะฒะฐะตั PDF ะดะพะบัะผะตะฝัั ั ะบะธัะธะปะปะธัะตัะบะธะผ ัะตะบััะพะผ, ัะพััะฐะฝัะตั ะฒ PostgreSQL ะธ ะธะฝะดะตะบัะธััะตั ะฒ ChromaDB ะดะปั ะฑััััะพะณะพ ะฟะพะธัะบะฐ.

ะะพะผะฐะฝะดั ะฟัะพะฒะตัััั: Alembic ะผะธะณัะฐัะธะธ, OCR ะพะฑัะฐะฑะพัะบั PDF/ZIP ัะฐะนะปะพะฒ, ัะพััะฐะฝะตะฝะธะต ะฒ ะะ, ะธะฝะดะตะบัะฐัะธั ะฒ ChromaDB, ะฟะพะธัะบะพะฒัั ััะฝะบัะธะพะฝะฐะปัะฝะพััั ั fail-safe ะฟะพะฒะตะดะตะฝะธะตะผ.

### ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตััะธัะพะฒะฐะฝะธะต

```bash
# Apply Alembic migrations
make etl-migrate

# Run ETL unit tests
make etl-test

# Run full integration tests (OCR + ChromaDB)
make test-priority2
```

### ะััะฝะฐั ะฟัะพะฒะตัะบะฐ ัะตัะตะท curl

```bash
# Upload single PDF
curl -X POST -F "file=@test_files/scan1.pdf" http://localhost:7011/etl/upload

# Upload ZIP with multiple PDFs
curl -X POST -F "file=@test_files/scan_bundle.zip" http://localhost:7011/etl/upload

# Search in ChromaDB
curl -X POST http://localhost:7011/search \
  -H "Content-Type: application/json" \
  -d '{"query": "ะธัะบ", "collection": "etl_documents", "top_k": 3}'
```

### ะะตััะธะบะธ Sprint 2

- โ **Alembic ะผะธะณัะฐัะธะธ**: 100% ััะฟะตัะฝะพััั
- โ **E2E ัะตััั**: >80% ะฟะพะบัััะธะต
- โ **ะะพะธัะบ**: ัะตะปะตะฒะฐะฝัะฝะพััั >85%

______________________________________________________________________

## ๐ End-to-End Workflow (Sprint 3)

ะ Sprint 3 ัะตะฐะปะธะทะพะฒะฐะฝ ะฟะพะปะฝัะน ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัะน workflow ะพั ะฟะพะปััะตะฝะธั ะปะพัะพะฒ ะธะท Goszakup API ะดะพ ะพัะฟัะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธะน ะฒ Telegram. ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะธะปััััะตั ะปะพัั ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ, ะพะฑัะฐะฑะฐััะฒะฐะตั ะดะพะบัะผะตะฝัั ัะตัะตะท OCR, ะธะฝะดะตะบัะธััะตั ะฒ ChromaDB ะธ ะพัะฟัะฐะฒะปัะตั ัะตะปะตะฒะฐะฝัะฝัะต ะฝะฐัะพะดะบะธ ะฒ Telegram.

### ะกัะตะผะฐ E2E Workflow

```mermaid
flowchart TD
    A[๐ Schedule Trigger<br/>Hourly, weekdays] --> B[๐ฅ Goszakup API<br/>Fetch lots]
    B --> C[๐ Keyword Filter<br/>ะปะฐะบ, ะบัะฐัะบะฐ, ะฟะพะบัััะธะต]
    C --> D[โฌ๏ธ ETL Service<br/>Download & OCR]
    D --> E[๐ ChromaDB<br/>Index documents]
    E --> F[๐ Search Results<br/>Semantic matching]
    F --> G[๐ฑ Telegram Bot<br/>Notifications]

    D --> H[(PostgreSQL<br/>etl_documents)]
    E --> I[(ChromaDB<br/>etl_documents)]

    style A fill:#e1f5fe
    style G fill:#c8e6c9
    style H fill:#fff3e0
    style I fill:#f3e5f5
```

### ะะพะผะฟะพะฝะตะฝัั Workflow

#### 1. n8n Workflow Automation

```bash
# ะะฐะฟััะบ n8n ัะตัะฒะธัะฐ
make n8n-up

# ะะผะฟะพัั ะณะพัะพะฒะพะณะพ workflow
# n8n UI: http://localhost:5678
# Import: n8n/workflows/goszakup-etl-workflow.json
```

**Workflow ะฒะบะปััะฐะตั:**

- **Schedule Trigger** - ะทะฐะฟััะบ ะบะฐะถะดัะน ัะฐั ะฒ ัะฐะฑะพัะธะต ะดะฝะธ
- **HTTP Request** - ะฟะพะปััะตะฝะธะต ะปะพัะพะฒ ะธะท Goszakup API
- **Function Filter** - ัะธะปัััะฐัะธั ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ ['ะปะฐะบ', 'ะบัะฐัะบะฐ', 'ะฟะพะบัััะธะต', 'ะผะฐัะตัะธะฐะป', 'ัััะพะธัะตะปัััะฒะพ']
- **ETL Upload** - ะพัะฟัะฐะฒะบะฐ ัะฐะนะปะพะฒ ะฝะฐ /etl/upload-url ะดะปั OCR ะพะฑัะฐะฑะพัะบะธ
- **ChromaDB Search** - ะฟะพะธัะบ ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ
- **Telegram Notification** - ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ะธ ะพัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน

#### 2. ETL Service Extensions

ะะพะฑะฐะฒะปะตะฝ ะฝะพะฒัะน ัะฝะดะฟะพะธะฝั `/etl/upload-url` ะดะปั ะทะฐะณััะทะบะธ ัะฐะนะปะพะฒ ะฟะพ URL:

```bash
# ะัะธะผะตั URL upload
curl -X POST http://localhost:7011/etl/upload-url \
  -H "Content-Type: application/json" \
  -d '{
    "file_url": "https://goszakup.gov.kz/files/lot_123.pdf",
    "file_name": "specification.pdf",
    "lot_id": "LOT_123"
  }'
```

#### 3. Keyword-Based Filtering

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะธะปััััะตั ะปะพัั ะฟะพ ัะตะปะตะฒะฐะฝัะฝัะผ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ:

- **ะปะฐะบ** - ะปะฐะบะพะฒัะต ะฟะพะบัััะธั, ะปะฐะบะธัะพะฒะบะฐ
- **ะบัะฐัะบะฐ** - ะบัะฐัะบะธ, ะฟะพะบัะฐัะพัะฝัะต ัะฐะฑะพัั
- **ะฟะพะบัััะธะต** - ะทะฐัะธัะฝัะต ะฟะพะบัััะธั, ะพัะดะตะปะบะฐ
- **ะผะฐัะตัะธะฐะป** - ัััะพะธัะตะปัะฝัะต ะผะฐัะตัะธะฐะปั
- **ัััะพะธัะตะปัััะฒะพ** - ัััะพะธัะตะปัะฝัะต ัะฐะฑะพัั

#### 4. Telegram Notifications

ะะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั ะฒ ัะพัะผะฐัะต:

```
๐ ะะฐะนะดะตะฝ ัะตะปะตะฒะฐะฝัะฝัะน ะดะพะบัะผะตะฝั

๐ ะะพั: ะะพััะฐะฒะบะฐ ะปะฐะบะพะฒัั ะฟะพะบัััะธะน
๐ ID: LOT_12345
๐ฐ ะกัะผะผะฐ: 1 500 000 โธ

๐ ะะพะบัะผะตะฝั: specification.pdf
โญ ะะตะปะตะฒะฐะฝัะฝะพััั: 87%

๐ ะคัะฐะณะผะตะฝั: ะขะตัะฝะธัะตัะบะฐั ัะฟะตัะธัะธะบะฐัะธั ะปะฐะบะพะฒัั...

๐ ะกััะปะบะฐ: https://goszakup.gov.kz/lot/12345
๐ท๏ธ ะะปััะตะฒัะต ัะปะพะฒะฐ: ะปะฐะบ, ะฟะพะบัััะธะต
```

### ะขะตััะธัะพะฒะฐะฝะธะต E2E Workflow

#### ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตััะธัะพะฒะฐะฝะธะต

```bash
# ะะพะปะฝัะน E2E ัะตัั (ะฒัะต ัะตัะฒะธัั + workflow)
make test-priority3

# ะัะดะตะปัะฝัะต ะบะพะผะฟะพะฝะตะฝัั
bash services/etl-service/test_e2e_workflow.sh
bash services/etl-service/test_etl_upload.sh
```

#### ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั

ะกะธััะตะผะฐ ะฟัะพัะพะดะธั ัะปะตะดัััะธะต ะฟัะพะฒะตัะบะธ:

- โ **Keyword Filtering**: 100% ัะพัะฝะพััั ะฝะฐ ัะตััะพะฒัั ะดะฐะฝะฝัั
- โ **URL Download**: ััะฟะตัะฝะฐั ะทะฐะณััะทะบะฐ PDF ัะฐะนะปะพะฒ ะฟะพ URL
- โ **OCR Processing**: ะธะทะฒะปะตัะตะฝะธะต ัะตะบััะฐ ะธะท ััััะบะพัะทััะฝัั ะดะพะบัะผะตะฝัะพะฒ
- โ **ChromaDB Indexing**: ะธะฝะดะตะบัะฐัะธั ะฒ ัะตัะตะฝะธะต 5 ัะตะบัะฝะด
- โ **Search Relevance**: ัะตะปะตะฒะฐะฝัะฝะพััั ะฟะพะธัะบะฐ >85%
- โ **E2E Performance**: ะฟะพะปะฝัะน ัะธะบะป \<10 ะผะธะฝัั (SLA)
- โ **Telegram Integration**: ะบะพััะตะบัะฝะพะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ัะฒะตะดะพะผะปะตะฝะธะน
- โ **Fail-soft Behavior**: ะฟัะพะดะพะปะถะตะฝะธะต ัะฐะฑะพัั ะฟัะธ ะฝะตะดะพัััะฟะฝะพััะธ ะพัะดะตะปัะฝัั ัะตัะฒะธัะพะฒ

### CI/CD Integration

ะะพะฑะฐะฒะปะตะฝ `priority3-integration` job ะฒ GitHub Actions:

```yaml
# ะะฐะฟััะบะฐะตั ะฒัะต ะฝะตะพะฑัะพะดะธะผัะต ัะตัะฒะธัั
# ะัะฟะพะปะฝัะตั E2E ัะตััะธัะพะฒะฐะฝะธะต
# ะัะพะฒะตััะตั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั workflow
# ะะฐะณััะถะฐะตั ะฐััะตัะฐะบัั ัะตััะธัะพะฒะฐะฝะธั
```

### Performance Metrics

- **Keyword Filtering**: \<1 ัะตะบัะฝะดะฐ ะฝะฐ 100 ะปะพัะพะฒ
- **File Download**: 2-5 ัะตะบัะฝะด ะฝะฐ PDF ัะฐะนะป
- **OCR Processing**: 5-15 ัะตะบัะฝะด ะฝะฐ ัััะฐะฝะธัั
- **ChromaDB Indexing**: 1-3 ัะตะบัะฝะดั ะฝะฐ ะดะพะบัะผะตะฝั
- **Search Query**: \<500ms ะดะปั top-5 ัะตะทัะปััะฐัะพะฒ
- **Telegram Delivery**: \<2 ัะตะบัะฝะดั

### Monitoring & Alerting

```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ workflow
curl http://localhost:5678/api/v1/workflows

# ะะพะฝะธัะพัะธะฝะณ ETL service
curl http://localhost:7011/health

# ะัะพะฒะตัะบะฐ ChromaDB
curl http://localhost:8010/api/v1/heartbeat

# ะัะพะฒะตัะบะฐ Web UI
curl http://localhost:8082/health

# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f n8n etl-service web-ui
```

______________________________________________________________________

## ๐ ะะฐะฑะพัะฐ ั ะผะธะณัะฐัะธัะผะธ

ZakupAI ะธัะฟะพะปัะทัะตั Alembic ะดะปั ัะฟัะฐะฒะปะตะฝะธั ััะตะผะพะน ะฑะฐะทั ะดะฐะฝะฝัั ะฒ ะบะฐะถะดะพะผ ัะตัะฒะธัะต.

### ะัััััะต ะบะพะผะฐะฝะดั

```bash
# ะกะพะทะดะฐัั ะผะธะณัะฐัะธั
make mig-revision SERVICE=billing-service m="add user table"

# ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ
make mig-upgrade SERVICE=billing-service

# ะัะบะฐัะธัั ะผะธะณัะฐัะธั
make mig-downgrade SERVICE=billing-service r="-1"

# ะัะพะฒะตัะธัั SQL (dry-run)
make mig-sql SERVICE=billing-service
```

### Production deployment

**โ๏ธ ะะะะะ: ะัะตะณะดะฐ ะฒัะฟะพะปะฝัะนัะต dry-run ะฟะตัะตะด production:**

```bash
# 1. ะกะณะตะฝะตัะธัะพะฒะฐัั SQL ะดะปั ะฟัะพะฒะตัะบะธ
make mig-sql SERVICE=billing-service > migration.sql

# 2. ะัะพะฒะตัะธัั SQL ะฒัััะฝัั
cat migration.sql

# 3. ะกะพะทะดะฐัั backup ะะ ะธ ะฟัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ
make mig-upgrade SERVICE=billing-service
```

### Migration runners

ะ Stage6 ะดะพัััะฟะฝั migration-runner ัะตัะฒะธัั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฟัะธะผะตะฝะตะฝะธั ะผะธะณัะฐัะธะน ะฟัะธ ะดะตะฟะปะพะต:

- `migration-runner-billing`
- `migration-runner-calc`
- `migration-runner-doc`
- `migration-runner-embedding`
- `migration-runner-etl`
- `migration-runner-risk`

**ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ:**

- ะัะต runners ะธัะฟะพะปัะทััั ะพะฑัะธะน `Dockerfile.migration` ั ะฟัะตะดัััะฐะฝะพะฒะปะตะฝะฝัะผะธ ะทะฐะฒะธัะธะผะพัััะผะธ
- ะะพะด ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ ะผะพะฝัะธััะตััั ัะตัะตะท volume mount ะฒ `/app`
- DATABASE_URL ะฝะฐัััะฐะธะฒะฐะตััั ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ั fallback

### ะะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัะน ัะบัะธะฟั

ะะปั ัะดะพะฑััะฒะฐ ะทะฐะฟััะบะฐ ะผะธะณัะฐัะธะน ะฒัะตั ัะตัะฒะธัะพะฒ ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน:

```bash
# ะะฐะฟััะบ ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัั ะผะธะณัะฐัะธะน Stage6
./stage6-migrations.sh
```

ะกะบัะธะฟั ะฒัะฟะพะปะฝะธั ะฑะตะทะพะฟะฐัะฝัะน ัะธะบะป: ะฟัะพะฒะตัะบะฐ ััะฐัััะฐ โ dry-run preview โ ะฟัะธะผะตะฝะตะฝะธะต ั ะฟะพะดัะฒะตัะถะดะตะฝะธะตะผ โ ัะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ.

ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ: [MIGRATIONS.md](docs/ops/migrations/MIGRATIONS.md)

______________________________________________________________________

## ๐ฅ Web UI Integration (Sprint 3)

ะ Sprint 3 ะดะพะฑะฐะฒะปะตะฝะฐ ะฟะพะปะฝะฐั ะธะฝัะตะณัะฐัะธั Web UI ั Goszakup API, ETL ัะตัะฒะธัะพะผ ะธ ChromaDB ะฟะพะธัะบะพะผ. Web UI ะฟัะตะดะพััะฐะฒะปัะตั ัะดะพะฑะฝัะน ะฒะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฐะฑะพัั ั ะปะพัะฐะผะธ ะธ ะดะพะบัะผะตะฝัะฐะผะธ.

### ะะพะทะผะพะถะฝะพััะธ Web UI

#### ๐ ะะฝัะตะณัะฐัะธั ั Goszakup API

```bash
# ะะพะปััะธัั ะปะพัั ะฝะฐะฟััะผัั ะธะท Goszakup API
curl -s http://localhost:8082/lots | jq '.'
```

Web UI ะดะตะปะฐะตั ะทะฐะฟัะพัั ะฒ Goszakup API ะธัะฟะพะปัะทัั ัะพะบะตะฝ ะธะท ะฟะตัะตะผะตะฝะฝะพะน ะพะบััะถะตะฝะธั `GOSZAKUP_TOKEN`. ะะพะทะฒัะฐัะฐะตั ะฟะตัะฒัะต 5 ะปะพัะพะฒ ะฒ JSON ัะพัะผะฐัะต.

#### ๐ ะัะพะบัะธัะพะฒะฐะฝะธะต ETL ะพะฟะตัะฐัะธะน

```bash
# ะะฐะณััะทะบะฐ ัะฐะนะปะฐ ัะตัะตะท Web UI โ ETL Service
curl -X POST http://localhost:8082/etl/upload \
  -F "file=@test_document.pdf"

# ะะพะธัะบ ะดะพะบัะผะตะฝัะพะฒ ัะตัะตะท Web UI โ ETL Service โ ChromaDB
curl -X POST http://localhost:8082/search \
  -H "Content-Type: application/json" \
  -d '{"query": "ะปะฐะบะพะฒัะต ะฟะพะบัััะธั", "top_k": 5, "collection": "etl_documents"}'
```

#### ๐จ HTML ะธะฝัะตััะตะนั

- **ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ** (http://localhost:8082) - ะฟะพะธัะบ ะธ ะทะฐะณััะทะบะฐ ัะฐะนะปะพะฒ
- **ะกััะฐะฝะธัะฐ ะปะพัะฐ** (http://localhost:8082/lot/{id}) - ะฐะฝะฐะปะธะท ะบะพะฝะบัะตัะฝะพะณะพ ะปะพัะฐ
- **ะะฐะณััะทะบะฐ ัะฐะนะปะพะฒ** (http://localhost:8082/upload) - ะผะฐััะพะฒะฐั ะพะฑัะฐะฑะพัะบะฐ CSV/XLSX
- **ะัะพัะผะพัั ะฒะปะพะถะตะฝะธะน** (http://localhost:8082/attachments) - OCR ัะตะทัะปััะฐัั

### ะััะธัะตะบัััะฐ ะธะฝัะตะณัะฐัะธะธ

```mermaid
flowchart LR
    U[๐ค User Browser] --> W[๐ฅ Web UI :8082]
    W --> G[๐ Goszakup API]
    W --> E[โก ETL Service :7011]
    W --> GW[๐ช API Gateway :8080]

    E --> DB[(PostgreSQL)]
    E --> CB[(ChromaDB)]

    style W fill:#e3f2fd
    style G fill:#fff3e0
    style E fill:#e8f5e8
```

### ะะฐะฟััะบ Web UI

```bash
# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ ะฒะบะปััะฐั Web UI
docker compose up -d web-ui

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
docker compose ps web-ui
curl http://localhost:8082/health

# ะัะพะฒะตัะบะฐ ะธะฝัะตะณัะฐัะธะธ ั Goszakup API
curl -s http://localhost:8082/lots | jq '.lots[0].nameRu'
```

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

Web UI ะธัะฟะพะปัะทัะตั ัะปะตะดัััะธะต ะฟะตัะตะผะตะฝะฝัะต ะธะท `.env`:

```bash
# Goszakup API ะธะฝัะตะณัะฐัะธั
GOSZAKUP_TOKEN=your_api_token_here
GOSZAKUP_BASE=https://ows.goszakup.gov.kz

# ะะฝัััะตะฝะฝะธะต ัะตัะฒะธัั
GATEWAY_URL=http://gateway
ZAKUPAI_API_KEY=changeme
```

### ะขะตััะธัะพะฒะฐะฝะธะต ะฒ CI/CD

ะะพะฑะฐะฒะปะตะฝ ัะฟะตัะธะฐะปัะฝัะน `web-ui-integration` job ะฒ GitHub Actions:

- ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ Web UI ะบะพะฝัะตะนะฝะตัะฐ
- ะขะตััะธัะพะฒะฐะฝะธะต ัะฝะดะฟะพะธะฝัะฐ `/health`
- ะัะพะฒะตัะบะฐ ะธะฝัะตะณัะฐัะธะธ ั Goszakup API ัะตัะตะท `/lots`
- ะะฐะปะธะดะฐัะธั JSON ะพัะฒะตัะพะฒ

### Fail-Safe ะฟะพะฒะตะดะตะฝะธะต

Web UI ัะตะฐะปะธะทัะตั ัััะพะนัะธะฒะพััั ะบ ัะฑะพัะผ:

- ะขะฐะนะผะฐััั ะดะปั ะฒัะตั ะฒะฝะตัะฝะธั ะทะฐะฟัะพัะพะฒ (30-60 ัะตะบัะฝะด)
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ั ะปะพะณะธัะพะฒะฐะฝะธะตะผ
- ะัะพะบัะธัะพะฒะฐะฝะธะต HTTP ััะฐััั ะบะพะดะพะฒ ะพั ะฒะฝะตัะฝะธั API
- Graceful ะดะตะณัะฐะดะฐัะธั ะฟัะธ ะฝะตะดะพัััะฟะฝะพััะธ ัะตัะฒะธัะพะฒ

______________________________________________________________________

## ๐งช E2E Web UI Testing

ะ Sprint 3 ัะตะฐะปะธะทะพะฒะฐะฝะพ ะบะพะผะฟะปะตะบัะฝะพะต E2E ัะตััะธัะพะฒะฐะฝะธะต Web UI ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะปะฝะพะณะพ ะฟะฐะนะฟะปะฐะนะฝะฐ: **Web UI โ goszakup-api โ etl-service โ ChromaDB**.

### ะขะตััะพะฒัะต ะบะพะผะฐะฝะดั

```bash
# ะะพะผะฟะปะตะบัะฝะพะต E2E ัะตััะธัะพะฒะฐะฝะธะต Web UI
make webui-test

# Smoke-ัะตััั ะบะปััะตะฒัั ัะฝะดะฟะพะธะฝัะพะฒ ัะตัะตะท curl
bash web/test_e2e_webui.sh

# ะัะพะฒะตัะบะฐ ะพัะดะตะปัะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ
curl -s http://localhost:8082/health
curl -s "http://localhost:8082/lots?keyword=ะปะฐะบ&limit=2"
```

### ะะพะบัััะธะต ัะตััะพะฒ

**pytest ัะตััั (web/test_e2e_webui.py):**

- โ `GET /health` โ `{"status": "ok"}`
- โ `GET /lots?keyword=ะปะฐะบ&limit=2` โ JSON ั lots (>0, ะบะธัะธะปะปะธัะฐ)
- โ `POST /etl/upload` โ ะพัะฟัะฐะฒะบะฐ `scan1.pdf` โ JSON ั `content_preview`
- โ `POST /search/documents` โ ะฟะพะธัะบ "ะธัะบ" โ ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั (โฅ1)
- โ ะะพะปะฝัะน ะฟะฐะนะฟะปะฐะนะฝ: ะทะฐะณััะทะบะฐ โ ะพะฑัะฐะฑะพัะบะฐ โ ะฟะพะธัะบ

**bash ัะตััั (web/test_e2e_webui.sh):**

- ๐ Smoke-ัะตััั ัะตัะตะท curl ะธ jq
- โ/โ ะธะฝะดะธะบะฐัะพัั ะดะปั ะบะฐะถะดะพะณะพ ัะฝะดะฟะพะธะฝัะฐ
- ๐ ะะตััะธะบะธ: ะบะพะปะธัะตััะฒะพ ะปะพัะพะฒ, ัะฐะทะผะตั preview, ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ
- ๐ ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ะฟะพะปะฝะพะณะพ ะฟะฐะนะฟะปะฐะนะฝะฐ

### ะะตััะธะบะธ ััะฟะตัะฐ

- `/health` ะดะพัััะฟะตะฝ ะฒ 100% ัะปััะฐะตะฒ
- `/lots?keyword=ะปะฐะบ` ะฒะพะทะฒัะฐัะฐะตั >0 ัะตะทัะปััะฐัะพะฒ ั ะบะธัะธะปะปะธัะตะน
- `/etl/upload` ะฒะพะทะฒัะฐัะฐะตั `content_preview` ะดะปะธะฝะพะน >0
- `/search/documents` ะฒะพะทะฒัะฐัะฐะตั โฅ1 ะดะพะบัะผะตะฝั, ัะพะดะตัะถะฐัะธะน "ะธัะบ"
- CI job ะฟัะพัะพะดะธั ััะฟะตัะฝะพ (exit code 0)

### ะะฝัะตะณัะฐัะธั ะฒ CI/CD

ะะพะฑะฐะฒะปะตะฝ `webui-e2e-test` job ะฒ GitHub Actions:

- ะะพะดะฝะธะผะฐะตั ะฟะพะปะฝัะน ััะตะบ: db, goszakup-api, etl-service, chromadb, web-ui
- ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั jq ะธ ัะธััะตะผะฝัะต ะทะฐะฒะธัะธะผะพััะธ
- ะกะพะทะดะฐะตั ัะตััะพะฒัั ัะธะบััััั `scan1.pdf` ั ะบะธัะธะปะปะธัะตะน ะตัะปะธ ะพััััััะฒัะตั
- ะะฐะฟััะบะฐะตั `make webui-test`
- ะกะพััะฐะฝัะตั ะฐััะตัะฐะบัั: test_results.xml, ะปะพะณะธ ัะตัะฒะธัะพะฒ
- ะะฐะฒะตััะฐะตั ั `docker-compose down`

### ะขะตััะพะฒะฐั ัะธะบััััะฐ

ะกะพะทะดะฐะฝะฐ `web/test_fixtures/scan1.pdf` ั ัะพะดะตัะถะธะผัะผ:

- "ะขะตััะพะฒัะน ะดะพะบัะผะตะฝั ะดะปั OCR"
- "ะกะพะดะตัะถะธั ะธะฝัะพัะผะฐัะธั ะพะฑ ะธัะบะต ะพ ะทะฐะบัะฟะบะต ะปะฐะบะฐ"
- "ะะปั ัะตััะธัะพะฒะฐะฝะธั ะฟะพะธัะบะฐ ะฟะพ ะบะปััะตะฒะพะผั ัะปะพะฒั 'ะธัะบ'"

ะคะธะบััััะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตััั ะฒ CI ะตัะปะธ ะพััััััะฒัะตั.

______________________________________________________________________

## ๐ Stage6 Monitoring Test Suite

ะ Stage6 ัะตะฐะปะธะทะพะฒะฐะฝ ะฟะพะปะฝะพัะตะฝะฝัะน ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัะน ัะบัะธะฟั ะดะปั ะฟัะพะฒะตัะบะธ ะธะฝััะฐััััะบัััั ะผะพะฝะธัะพัะธะฝะณะฐ ZakupAI.

### ๐ฏ ะงัะพ ะฟัะพะฒะตััะตััั (10 ัะฐะณะพะฒ)

#### [1/10] ะะฐะฒะธัะธะผะพััะธ

- `curl`, `jq`, `docker` โ ะฑะฐะทะพะฒัะต ััะธะปะธัั
- `promtool` โ ะฒะฐะปะธะดะฐัะธั ะบะพะฝัะธะณะพะฒ Prometheus
- `amtool` โ ะฒะฐะปะธะดะฐัะธั ะบะพะฝัะธะณะพะฒ Alertmanager
- `python3` โ ะดะปั ะทะฐะฟััะบะฐ ัะตััะพะฒ ะผะตััะธะบ

#### [2/10] Docker Stack Management

- ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ ะผะพะฝะธัะพัะธะฝะณะพะฒะพะณะพ ััะตะบะฐ
- 3 docker-compose ัะฐะนะปะฐ + profile stage6
- Graceful ะพััะฐะฝะพะฒะบะฐ ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ

#### [3/10] Service Health Checks

ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ ะฒัะตั 7 ัะตัะฒะธัะพะฒ:

- **Prometheus** โ `http://localhost:9090/-/healthy`
- **Alertmanager** โ `http://localhost:9093/-/healthy`
- **Grafana** โ `http://localhost:3030/api/health`
- **Node Exporter** โ `http://localhost:19100/metrics`
- **cAdvisor** โ `http://localhost:8081/healthz`
- **Loki** โ `http://localhost:3100/ready`
- **Blackbox Exporter** โ `http://localhost:9115/-/healthy`

ะะฐะถะดัะน ัะตัะฒะธั ะฟัะพะฒะตััะตััั ั ัะฐะนะผะฐััะพะผ 60 ัะตะบัะฝะด ะธ ะฟะพะฒัะพัะฝัะผะธ ะฟะพะฟััะบะฐะผะธ ะบะฐะถะดัะต 3 ัะตะบัะฝะดั.

#### [4/10] Prometheus Targets Validation

API ะฟัะพะฒะตัะบะฐ `/api/v1/targets`:

- ะัะต jobs ะฒ ัะพััะพัะฝะธะธ `up` (prometheus, blackbox-http, cadvisor, node-exporter)
- ะะฐะปะธะดะฐัะธั health status ะบะฐะถะดะพะณะพ target
- ะะพะดัััั ะฐะบัะธะฒะฝัั targets ะฟะพ ะบะฐะถะดะพะผั job

#### [5/10] Prometheus Rules Validation

API ะฟัะพะฒะตัะบะฐ `/api/v1/rules`:

- ะะฐะณััะถะตะฝั ะฒัะต rule groups: `zakupai_infrastructure`, `zakupai_application`, `zakupai_business`
- ะะพะดัััั ะฟัะฐะฒะธะป ะฒ ะบะฐะถะดะพะน ะณััะฟะฟะต
- ะัะพะฒะตัะบะฐ ะบะพััะตะบัะฝะพััะธ ะทะฐะณััะทะบะธ

#### [6/10] Alertmanager Configuration

API ะฟัะพะฒะตัะบะฐ `/api/v2/status` ะธ `/api/v2/receivers`:

- Operational status
- ะะฐะปะธัะธะต ะธ ะบะพะฝัะธะณััะฐัะธั receivers (web.hook/default)
- Version info

#### [7/10] Static Configuration Validation

- `promtool check config monitoring/prometheus/prometheus.yml`
- `promtool check rules monitoring/prometheus/alerts.yml`
- `amtool check-config monitoring/alertmanager/alertmanager.yml`

#### [8/10] Loki & Promtail Integration

- ะัะพะฒะตัะบะฐ Loki readiness endpoint
- LogQL ะทะฐะฟัะพั ัะตัะตะท grafana/logcli: `{compose_project="zakupai"}`
- ะะฐะปะธะดะฐัะธั ะฟะพัััะฟะปะตะฝะธั ะปะพะณะพะฒ

#### [9/10] Custom Metrics Validation

- ะะฐะฟััะบ `python3 test_monitoring_metrics.py`
- ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ ะผะตััะธะบ ัะตัะตะท Prometheus API
- ะะฐะปะธะดะฐัะธั query endpoints

#### [10/10] Final Report

- ะกัะฐัะธััะธะบะฐ ะฒัะฟะพะปะฝะตะฝะธั (passed/failed/duration)
- ะัะพัะตะฝั ััะฟะตัะฝะพััะธ ัะตััะพะฒ
- Debugging ะบะพะผะฐะฝะดั ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ
- ะกััะปะบะธ ะฝะฐ UI ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ

### ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

```bash
# ะะพะปะฝัะน ัะตัั (ะทะฐะฟััะบะฐะตั ััะตะบ, ัะตััะธััะตั, ะฟัะตะดะปะฐะณะฐะตั ะพััะฐะฝะพะฒะบั)
./stage6-monitoring-test.sh

# CI ัะตะถะธะผ (ััะตะบ ัะถะต ะทะฐะฟััะตะฝ)
./stage6-monitoring-test.sh --ci

# ะก ัะพััะฐะฝะตะฝะธะตะผ ััะตะบะฐ ะฟะพัะปะต ัะตััะพะฒ
./stage6-monitoring-test.sh --keep-up

# ะกะฟัะฐะฒะบะฐ
./stage6-monitoring-test.sh --help

# ะงะตัะตะท Makefile
make monitoring-test           # ะะพะปะฝัะน ัะตัั
make monitoring-test-ci        # CI ัะตะถะธะผ
make monitoring-test-keep      # ะก ัะพััะฐะฝะตะฝะธะตะผ ััะตะบะฐ
```

### ๐ ะัะธะผะตั ะฒัะฒะพะดะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Stage6 Monitoring Test Suite - ZakupAI          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
[1/10] Checking Dependencies
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ curl is installed
โ jq is installed
โ docker is installed
โ promtool is installed
โ amtool is installed
โ python3 is installed

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
[3/10] Service Health Checks
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โน  Waiting for Prometheus at http://localhost:9090/-/healthy...
โ Prometheus is ready
โ Alertmanager is ready
โ Grafana is ready
โ Node Exporter is ready
โ cAdvisor is ready
โ Loki is ready
โ Blackbox Exporter is ready

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
[4/10] Validating Prometheus Targets
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โน  Fetching targets from Prometheus API...
โ Job 'prometheus': 1 target(s) UP
โ Job 'blackbox-http': 4 target(s) UP
โ Job 'cadvisor': 1 target(s) UP
โ Job 'node-exporter': 1 target(s) UP

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
[10/10] Test Summary Report
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Test Results Summary
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  โ Passed:  28 / 28 (100.0%)
  โ Failed:  0 / 28
  โฑ  Duration: 52s

๐ All monitoring tests passed!

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Debugging Commands
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  View service logs:
    docker compose logs zakupai-prometheus
    docker compose logs zakupai-alertmanager
    docker compose logs zakupai-loki
    docker compose logs zakupai-promtail-stage6
    docker compose logs zakupai-grafana

  Check service status:
    docker compose ps

  Access UIs:
    Prometheus:   http://localhost:9090
    Alertmanager: http://localhost:9093
    Grafana:      http://localhost:3030
    Loki:         http://localhost:3100
```

### ๐ง ะะปััะตะฒัะต ััะฝะบัะธะธ ัะบัะธะฟัะฐ

| ะคัะฝะบัะธั                          | ะะฟะธัะฐะฝะธะต                                                     |
| -------------------------------- | ------------------------------------------------------------ |
| `compose_cmd()`                  | Wrapper ะดะปั docker compose ั ะฟัะฐะฒะธะปัะฝัะผะธ ัะฐะนะปะฐะผะธ ะธ ะฟัะพัะธะปัะผะธ |
| `stack_up()` / `stack_down()`    | ะฃะฟัะฐะฒะปะตะฝะธะต ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ ะผะพะฝะธัะพัะธะฝะณะพะฒะพะณะพ ััะตะบะฐ            |
| `wait_for_http()`                | ะะถะธะดะฐะฝะธะต HTTP endpoint ั ัะฐะนะผะฐััะพะผ 60s ะธ ะฟะพะฒัะพัะฐะผะธ           |
| `wait_for_logs()`                | ะะถะธะดะฐะฝะธะต ะฟะฐััะตัะฝะฐ ะฒ ะปะพะณะฐั ะบะพะฝัะตะนะฝะตัะฐ                         |
| `check_service_health()`         | ะัะพะฒะตัะบะฐ ะฒัะตั 7 ัะตัะฒะธัะพะฒ ะผะพะฝะธัะพัะธะฝะณะฐ                         |
| `validate_prometheus_targets()`  | API `/api/v1/targets` โ ะฒะฐะปะธะดะฐัะธั jobs                       |
| `validate_prometheus_rules()`    | API `/api/v1/rules` โ ะฒะฐะปะธะดะฐัะธั rule groups                  |
| `validate_alertmanager_config()` | API `/api/v2/status` + `/api/v2/receivers`                   |
| `validate_static_configs()`      | promtool + amtool ััะฐัะธัะตัะบะธะต ะฟัะพะฒะตัะบะธ                       |
| `validate_loki_promtail()`       | Loki readiness + LogQL query                                 |
| `validate_metrics()`             | ะะฐะฟััะบ Python ัะบัะธะฟัะฐ ะผะตััะธะบ                                 |
| `generate_report()`              | ะคะธะฝะฐะปัะฝัะน ะพัััั ั ััะฐัะธััะธะบะพะน ะธ debugging hints              |

### ๐ฆ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
# ะะฐะทะพะฒัะต ััะธะปะธัั (Ubuntu/Debian)
sudo apt-get install curl jq docker.io python3

# Prometheus tools
cd /tmp
wget https://github.com/prometheus/prometheus/releases/download/v2.54.1/prometheus-2.54.1.linux-amd64.tar.gz
tar xf prometheus-2.54.1.linux-amd64.tar.gz
sudo cp prometheus-2.54.1.linux-amd64/promtool /usr/local/bin/

# Alertmanager tools
wget https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz
tar xf alertmanager-0.27.0.linux-amd64.tar.gz
sudo cp alertmanager-0.27.0.linux-amd64/amtool /usr/local/bin/

# Python ะทะฐะฒะธัะธะผะพััะธ
pip3 install requests
```

### โ๏ธ ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

- **Bash ะฒะตััะธั:** ััะตะฑัะตั bash 4.0+
- **Set flags:** `set -euo pipefail` ะดะปั ัััะพะณะพะณะพ ัะตะถะธะผะฐ
- **Trap handler:** ะพัะปะฐะฒะปะธะฒะฐะตั ะพัะธะฑะบะธ ะธ ะฒัะฒะพะดะธั ะฝะพะผะตั ัััะพะบะธ
- **Timeouts:** 60 ัะตะบัะฝะด ะดะปั health checks, 3 ัะตะบัะฝะดั ะผะตะถะดั ะฟะพะฟััะบะฐะผะธ
- **Exit codes:** 0 ะฟัะธ ััะฟะตัะต, 1 ะฟัะธ ะปัะฑัั ะฟัะพะฒะฐะปะฐั
- **ShellCheck:** ะบะพะด ัะพะฒะผะตััะธะผ ั ShellCheck (ะธัะฟะพะปัะทัะตั `[[`, ะบะพะฝััะฐะฝัั, ะบะฐะฒััะบะธ)

### ๐ ะคะฐะนะปะพะฒะฐั ััััะบัััะฐ

- [`stage6-monitoring-test.sh`](stage6-monitoring-test.sh) โ ะพัะฝะพะฒะฝะพะน ัะบัะธะฟั (624 ัััะพะบะธ, 22KB)
- [`test_monitoring_metrics.py`](test_monitoring_metrics.py) โ Python ะฒะฐะปะธะดะฐัะธั ะผะตััะธะบ ัะตัะตะท Prometheus API
- [`Makefile`](Makefile) โ 3 ะฝะพะฒัั ัะฐัะณะตัะฐ: `monitoring-test`, `monitoring-test-ci`, `monitoring-test-keep`
- `docker-compose.yml` + `docker-compose.override.stage6.yml` + `docker-compose.override.stage6.monitoring.yml` โ ััะตะบ ะผะพะฝะธัะพัะธะฝะณะฐ

______________________________________________________________________

## ๐ ะัะพะณะพะฒะฐั ะฐััะธัะตะบัััะฐ

ZakupAI โ ััะพ ะณะพัะพะฒะฐั ะธะฝััะฐััััะบัััะฐ:

- ะัะบะตะฝะด ัะตัะฒะธัั ะดะปั ะฐะฝะฐะปะธะทะฐ ัะตะฝะดะตัะพะฒ
- **๐ ะะพะปะฝัะน E2E workflow** ั ะฐะฒัะพะผะฐัะธะทะฐัะธะตะน ะพะฑัะฐะฑะพัะบะธ ะปะพัะพะฒ
- **๐ n8n Integration** ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะธั ะฟะฐะนะฟะปะฐะนะฝะพะฒ
- **๐ OCR Pipeline** ั ChromaDB ัะตะผะฐะฝัะธัะตัะบะธะผ ะฟะพะธัะบะพะผ
- **๐ URL-based Processing** ะดะปั ะธะฝัะตะณัะฐัะธะธ ั Goszakup API
- **๐ E2E Web UI Testing** ั ะฟะพะปะฝัะผ ะฟะพะบัััะธะตะผ ะฟะฐะนะฟะปะฐะนะฝะฐ
- **๐ Stage6 Monitoring Test Suite** โ ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะฐั ะฟัะพะฒะตัะบะฐ ะธะฝััะฐััััะบัััั ะผะพะฝะธัะพัะธะฝะณะฐ
- ะะฒัะพะผะฐัะธะทะฐัะธั ัะตัะตะท n8n ะธ Flowise
- ะะปะธะตะฝััะบะธะต ะธะฝัะตััะตะนัั (Telegram Bot, Web UI)
- ะัััะพะตะฝะฝัะน Billing Service (MVP)
- AI-ะธะฝัะตะณัะฐัะธั ัะตัะตะท Ollama ะธ Embedding API
- ะะพะปะฝัะน ััะตะบ ะผะพะฝะธัะพัะธะฝะณะฐ: Prometheus, Grafana, Loki, Alertmanager
- ะะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต ะผะพะฝะธัะพัะธะฝะณะฐ ั ะฒะฐะปะธะดะฐัะธะตะน ะบะพะฝัะธะณะพะฒ
- ะัะบะฐะฟั ะธ CI/CD ะดะปั ะฟัะพะดะฐะบัะฝ-ะณะพัะพะฒะฝะพััะธ
