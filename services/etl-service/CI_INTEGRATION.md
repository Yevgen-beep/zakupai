# ETL Service CI Integration

–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π smoke test –¥–ª—è ETL Service –≤ GitHub Actions pipeline.

## üöÄ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### `etl-smoke-test` job:

1. **üìÑ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö PDF —Ñ–∞–π–ª–æ–≤**

   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è mock PDF –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º –±–µ–∑ —Ç—è–∂–µ–ª—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

1. **üóÑÔ∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ PostgreSQL –º–∏–≥—Ä–∞—Ü–∏–π**

   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `attachments`
   - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
   - Foreign key constraints

1. **üîç OCR Loader –æ–±—Ä–∞–±–æ—Ç–∫–∞**

   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF —Ñ–∞–π–ª–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

1. **üìä –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

   - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
   - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
   - –ü–æ–¥—Å—á–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –¢–æ–ª—å–∫–æ `psycopg2-binary` –∏ `python-dotenv`
- **Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**: `ocr_loader_simple.py` –¥–ª—è CI –±–µ–∑ PyMuPDF/ChromaDB
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã GitHub Actions
- **–¢–∞–π–º–∞—É—Ç—ã**: 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ PostgreSQL
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: pip cache –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏

## üìã Workflow –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```yaml
etl-smoke-test:
  runs-on: ubuntu-latest
  needs: migrate
  steps:
    - Checkout –∫–æ–¥–∞
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python 3.11
    - –°—Ç–∞—Ä—Ç PostgreSQL —á–µ—Ä–µ–∑ docker compose
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - –ó–∞–ø—É—Å–∫ ./services/etl-service/smoke_test.sh
    - –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞:

- ‚úÖ –°–æ–∑–¥–∞–Ω–æ 2 mock PDF —Ñ–∞–π–ª–∞ (37971907.pdf, 37971908.pdf)
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ 2 –∑–∞–ø–∏—Å–∏ –≤ `attachments`
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- üéâ **"Smoke test finished successfully!"**

–¢–µ—Å—Ç —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –º–∞—Ç—Ä–∏—Ü—É `build` –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `etl-service`.
