[![CI](https://github.com/Yevgen-beep/zakupai/actions/workflows/ci.yml/badge.svg)](https://github.com/Yevgen-beep/zakupai/actions/workflows/ci.yml)

# ZakupAI

MVP-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≥–æ—Å–∑–∞–∫—É–ø–æ–∫ –†–ö.
ZakupAI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–Ω–¥–µ—Ä—ã, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫–∏–µ TL;DR, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–∏—Å–∫–∏ –∏ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∂–∞–ª–æ–±—ã, –∞ —Ç–∞–∫–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å n8n, Flowise –∏ Telegram-–±–æ—Ç–æ–º –¥–ª—è –±–∏–∑–Ω–µ—Å–∞.

______________________________________________________________________

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä —Ç–µ–Ω–¥–µ—Ä–æ–≤ (TL;DR, —Ä–∏—Å–∫-—Å–∫–æ—Ä–∏–Ω–≥, –º–∞—Ä–∂–∞, –ù–î–°, —à—Ç—Ä–∞—Ñ—ã)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: –ø–∏—Å—å–º–∞, –∂–∞–ª–æ–±—ã, –æ—Ç—á—ë—Ç—ã (PDF/HTML)
- **üÜï –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ª–æ—Ç–æ–≤** —Å GraphQL v2 –∏ REST v3 API
- **üÜï –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
- **üÜï –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **üÜï –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–∞–∑–º–µ—Ä—É
- Telegram-–±–æ—Ç @TenderFinderBot_bot –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ú–°–ë
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: Flowise (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ AI-–≤–æ—Ä–∫—Ñ–ª–æ—É), n8n (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ ¬´–≥–æ—Ä—è—á–∏–µ –ª–æ—Ç—ã¬ª (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ cron)
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≤—ã–≥–æ–¥–Ω–æ—Å—Ç–∏ —É—á–∞—Å—Ç–∏—è

______________________________________________________________________

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

ZakupAI –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (FastAPI + Docker).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

- **API Gateway** (`http://localhost:8080`) ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, rate limits, X-API-Key
- **Billing Service** (`:7004`) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, API –∫–ª—é—á–∏, –ª–∏–º–∏—Ç—ã, –ø–æ–¥–ø–∏—Å–∫–∏
- **Calc Service** (`:7001`) ‚Äî —Ä–∞—Å—á—ë—Ç—ã (–ù–î–°, –º–∞—Ä–∂–∞, —à—Ç—Ä–∞—Ñ—ã)
- **Risk Engine** (`:7002`) ‚Äî —Ä–∏—Å–∫-—Å–∫–æ—Ä–∏–Ω–≥ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- **Doc Service** (`:7003`) ‚Äî TL;DR, –ø–∏—Å—å–º–∞, PDF-—ç–∫—Å–ø–æ—Ä—Ç, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (ru/kz/en)
- **Embedding API** (`:7010`) ‚Äî –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–æ–∏—Å–∫, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ollama

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- **PostgreSQL** (`:5432`) ‚Äî –ª–æ—Ç—ã, —Ü–µ–Ω—ã, —Ä–∏—Å–∫–∏, —Ñ–∏–Ω—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã + billing —Å—Ö–µ–º–∞ (users, api_keys, usage, payments)
- **ChromaDB** (`:8000`) ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–æ–∏—Å–∫–∞

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

- **Telegram Bot** (@TenderFinderBot_bot)
  - `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  - `/key <API_KEY>` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫–ª—é—á–∞
  - `/lot <id|url>` ‚Äî –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–æ—Ç–∞
  - `/search <–∑–∞–ø—Ä–æ—Å>` ‚Äî –ø–æ–∏—Å–∫ –ª–æ—Ç–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
  - `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞
  - **üÜï –ö–æ–º–∞–Ω–¥—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
    - `/analytics` ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π
    - `/popular` ‚Äî —Ç–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    - `/mystats` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - **üÜï –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:**
    - `/cleanup [–¥–Ω–∏]` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π
    - `/dbinfo` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    - `/autocleanup [—Ä–∞–∑–º–µ—Ä_MB]` ‚Äî –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
- **Web UI** (`http://localhost:8082`) ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ—Ç–æ–≤, –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–π—Å–æ–≤ (CSV/XLSX)
- **Flowise** (`http://localhost:3000`) ‚Äî AI-–≤–æ—Ä–∫—Ñ–ª–æ—É (lot-reader, risk-explain, finance-calc, template-gen)
- **n8n** (`http://localhost:5678`) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –ø–∞–π–ø–ª–∞–π–Ω—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ DevOps

- **Prometheus** (`http://localhost:9090`) ‚Äî –º–µ—Ç—Ä–∏–∫–∏
- **Grafana** (`http://localhost:3001`) ‚Äî –¥–∞—à–±–æ—Ä–¥—ã
- **Alertmanager** (`http://localhost:9093`) ‚Äî –∞–ª–µ—Ä—Ç—ã
- **cAdvisor** (`http://localhost:8081`) ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- **Node Exporter** (`:9100`) –∏ **BlackBox Exporter** (`:9115`) ‚Äî –º–µ—Ç—Ä–∏–∫–∏ —Ö–æ—Å—Ç–∞ –∏ HTTP
- –ê–≤—Ç–æ–±—ç–∫–∞–ø—ã PostgreSQL (pg_dump + rclone ‚Üí B2/S3)
- CI/CD (lint, build, smoke-—Ç–µ—Å—Ç—ã)

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ `.env` —Ñ–∞–π–ª–æ–≤ (–ø–∞—Ä–æ–ª–∏, API –∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã)
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–µ–º API –∫–ª—é—á–∏ –∏–ª–∏ –ø–∞—Ä–æ–ª–∏ (—Ç–æ–ª—å–∫–æ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏)

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**

- Connection pooling —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ (min/max —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —Ç–∞–π–º–∞—É—Ç—ã)
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Pydantic –º–æ–¥–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã

**HTTP –∏ API:**

- SSL verification –≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Request/Response –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ X-Request-Id
- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ —É—Ç–µ—á–∫–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π

**Telegram Bot:**

- Rate limiting: –º–∞–∫—Å–∏–º—É–º 10 –∫–æ–º–∞–Ω–¥ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–≤–æ–¥–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ URL –∏ ID –ª–æ—Ç–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤, –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –≤–≤–æ–¥—ã)

**–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**

- –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è —Å Pydantic –¥–ª—è –≤—Å–µ—Ö API –º–æ–¥–µ–ª–µ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∑–∞—â–∏—Ç–∞ –æ—Ç DoS)
- Email –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ RFC —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
- UUID —Ñ–æ—Ä–º–∞—Ç –¥–ª—è API –∫–ª—é—á–µ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π

**Monitoring –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö security events —Å —É—Ä–æ–≤–Ω–µ–º WARNING
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π rate limits
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤

### AI –∏ Ollama

- **Ollama (host)** (`http://localhost:11434`)
- –ú–æ–¥–µ–ª–∏: `qwen3`, `llama3`, `mistral`, `deepseek-r1`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ LLM-–æ–±—Ä–∞–±–æ—Ç–∫–∏

### üìä –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫

**üÜï –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:**

- SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö API
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–æ–≤, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —á–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**üÜï –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ –ª—é–±–æ–π –ø–µ—Ä–∏–æ–¥ (—Ç–æ–ø-10)
- –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–æ–≤, –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–±–ª–µ–º –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö API (GraphQL v2 vs REST v3)

**üÜï –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã
- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—á–∏—Å—Ç–∫–∏:
  - < 50 MB: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (90 –¥–Ω–µ–π)
  - 50-100 MB: —É–º–µ—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (60 –¥–Ω–µ–π)
  - \> 100 MB: –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (30 –¥–Ω–µ–π)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è VACUUM –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- Cron —Å–∫—Ä–∏–ø—Ç –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

**üÜï Telegram –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**

- `/analytics` ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π
- `/popular [–¥–Ω–∏]` ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
- `/mystats [–¥–Ω–∏]` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/cleanup [–¥–Ω–∏]` ‚Äî —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ (–∞–¥–º–∏–Ω—ã)
- `/dbinfo` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–∞–∑—ã (–∞–¥–º–∏–Ω—ã)
- `/autocleanup [–ú–ë]` ‚Äî –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ (–∞–¥–º–∏–Ω—ã)

**üìÅ –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã:**

- `bot/user_metrics.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –º–µ—Ç—Ä–∏–∫ –∏ –æ—á–∏—Å—Ç–∫–∏
- `bot/analytics_service.py` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è Telegram
- `cleanup_logs.py` ‚Äî —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —á–µ—Ä–µ–∑ cron
- `docs/LOG_CLEANUP.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—á–∏—Å—Ç–∫–∏

______________________________________________________________________

### üîó –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

````mermaid
flowchart LR
    TG[Telegram Bot] -->|/key /lot|
    B[Billing Service]
    W[Web UI] --> B
    F[‚ö° Flowise] --> B
    N[n8n Workflows] --> B

    B --> G[API Gateway]

    G --> C[Calc Service]
    G --> R[Risk Engine]
    G --> D[Doc Service]
    G --> E[Embedding API]

    E --> O[Ollama (host)]
    G --> DB[(PostgreSQL)]
    E --> CH[(ChromaDB)]

üîë Billing Service
MVP (Stage)
PostgreSQL (—Å—Ö–µ–º–∞ billing):
users ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
api_keys ‚Äî API-–∫–ª—é—á–∏ –∏ –ø–ª–∞–Ω—ã
usage ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
payments ‚Äî –æ–ø–ª–∞—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏

FastAPI endpoints:
POST /billing/create_key ‚Äî —Å–æ–∑–¥–∞—Ç—å API-–∫–ª—é—á (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ /start)
POST /billing/validate_key ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–∞ + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
POST /billing/usage ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
GET /billing/stats/{tg_id} ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤:
Free: 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å, 20/—á–∞—Å
Premium: 5000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å, 500/—á–∞—Å
Docker: —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ :7004, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ–±—â–∏–π docker-compose

–¢–∞—Ä–∏—Ñ—ã
–ü–ª–∞–Ω	                –õ–∏–º–∏—Ç –≤ –¥–µ–Ω—å	   –õ–∏–º–∏—Ç –≤ —á–∞—Å	        –¶–µ–Ω–∞
Free	                    100	              20	            0 ‚Ç∏
Premium	                  5000	            500	            10 000 ‚Ç∏


–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
Telegram Bot: –≤—ã–¥–∞—ë—Ç –∫–ª—é—á–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ö –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏–∑–æ–º –ª–æ—Ç–∞
Gateway: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–ª—é—á–∏ –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ API
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã ZakupAI: —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Billing –≤–∞–ª–∏–¥–∞—Ü–∏—é

–°–≤–æ–¥–∫–∞ –ø–æ –ø–æ—Ä—Ç–∞–º
Gateway ‚Äî http://localhost:8080
Web UI ‚Äî http://localhost:8082 (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å goszakup-api)
Telegram Bot ‚Äî @TenderFinderBot_bot
Flowise ‚Äî http://localhost:3000
n8n ‚Äî http://localhost:5678
Postgres ‚Äî :5432
ChromaDB ‚Äî :8000
Calc Service ‚Äî :7001
Risk Engine ‚Äî :7002
Doc Service ‚Äî :7003
Billing Service ‚Äî :7004
Goszakup API ‚Äî :7005 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ì–æ—Å–ó–∞–∫—É–ø)
ETL Service ‚Äî :7011 (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ OCR)
Embedding API ‚Äî :7010
Ollama (host) ‚Äî http://localhost:11434
Prometheus ‚Äî http://localhost:9090
Grafana ‚Äî http://localhost:3001
Alertmanager ‚Äî http://localhost:9093
cAdvisor ‚Äî http://localhost:8081
Node Exporter ‚Äî http://localhost:9100
BlackBox Exporter ‚Äî http://localhost:9115

Security & DevOps
Rate limits: 60 req/min (Nginx Gateway)
X-API-Key –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
CORS/CSRF –ø–æ–ª–∏—Ç–∏–∫–∞: dev ‚Äî –æ—Ç–∫—Ä—ã—Ç–∞—è, stage ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è, prod ‚Äî —Å—Ç—Ä–æ–≥–∞—è
–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (FastAPI deps)
Pre-commit —Ö—É–∫–∏: ruff, black, isort, yamllint, mdformat
SAST (Bandit) –≤ CI
–ê–≤—Ç–æ–±—ç–∫–∞–ø—ã PostgreSQL (pg_dump + rclone ‚Üí B2/S3)

–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è
Freemium ‚Üí Premium –ø–æ–¥–ø–∏—Å–∫–∞ (10 000 ‚Ç∏/–º–µ—Å)
–ü–∞–∫–µ—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (3 000‚Äì10 000 ‚Ç∏ –∑–∞ –∫–æ–º–ø–ª–µ–∫—Ç)
AI-–æ—Ç—á—ë—Ç—ã PDF –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤
White Label –¥–ª—è —é—Ä–∏—Å—Ç–æ–≤ –∏ –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π

–í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–û–ö–≠–î)
62.01.1 ‚Äî –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û –∏ SaaS (–æ—Å–Ω–æ–≤–Ω–æ–π)
62.01.2 ‚Äî –ò–¢-–∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –ò–ò
63.11.1 ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, API —Å–µ—Ä–≤–∏—Å—ã
62.03.0 ‚Äî MLOps –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
62.09.0 ‚Äî –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ IT-—Ä–µ—à–µ–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo_url>
cd zakupai

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
cp .env.example .env
cp bot/.env.example bot/.env

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Goszakup API Token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Web UI)
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞ https://ows.goszakup.gov.kz
# –û–±–Ω–æ–≤–∏—Ç–µ GOSZAKUP_TOKEN –≤ .env
````

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Bot (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `bot/.env`:

```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather –≤ Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_here

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
ENVIRONMENT=development

# –î–ª—è production –¥–æ–±–∞–≤—å—Ç–µ webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_WEBHOOK_URL=https://your-domain.com/webhook/telegram
TELEGRAM_WEBHOOK_SECRET=your_webhook_secret
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f zakupai-bot
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±–æ—Ç–∞
docker exec zakupai-bot env | grep TELEGRAM

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
curl -s "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getWebhookInfo" | python3 -m json.tool

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API Gateway
curl http://localhost:8080/health
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –ø–æ —Ç–æ–∫–µ–Ω—É
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã `/help`, `/search –∫–æ–º–ø—å—é—Ç–µ—Ä—ã`

______________________________________________________________________

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

**Development (polling):**

- `ENVIRONMENT=development` –≤ `bot/.env`
- –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ polling (–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**Production (webhook):**

- `ENVIRONMENT=production` –∏–ª–∏ `staging` –≤ `bot/.env`
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `TELEGRAM_WEBHOOK_URL` –∏ `TELEGRAM_WEBHOOK_SECRET`
- Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
- –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è production

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

- `.env` ‚Äî –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ë–î, API, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- `bot/.env` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ bot/.env:**

```bash
TELEGRAM_BOT_TOKEN=       # –¢–æ–∫–µ–Ω –æ—Ç @BotFather
TELEGRAM_WEBHOOK_URL=     # URL –¥–ª—è webhook (production)
TELEGRAM_WEBHOOK_SECRET=  # –°–µ–∫—Ä–µ—Ç –¥–ª—è webhook (production)
ENVIRONMENT=              # development/staging/production
N8N_WEBHOOK_URL=         # URL n8n –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª–æ—Ç–æ–≤
```

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
docker exec zakupai-bot env | grep TELEGRAM_BOT_TOKEN

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs zakupai-bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker-compose restart zakupai-bot
```

**–û—à–∏–±–∫–∞ "Missing required environment variables: TELEGRAM_BOT_TOKEN":**

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `bot/.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –Ω–µ–º –µ—Å—Ç—å `TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose restart zakupai-bot`

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ë–î –æ—Ç–¥–µ–ª—å–Ω–æ
docker-compose up -d db

# –î–æ–∂–¥–∏—Ç–µ—Å—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (~30 —Å–µ–∫—É–Ω–¥)
docker-compose logs db

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker-compose up -d zakupai-bot
```

______________________________________________________________________

## Testing OCR & Search (Sprint 2)

–í –°–ø—Ä–∏–Ω—Ç–µ 2 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π OCR pipeline —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –ë–î –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π ChromaDB –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤ ChromaDB –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞.

–ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç: Alembic –º–∏–≥—Ä–∞—Ü–∏–∏, OCR –æ–±—Ä–∞–±–æ—Ç–∫—É PDF/ZIP —Ñ–∞–π–ª–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤ ChromaDB, –ø–æ–∏—Å–∫–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å fail-safe –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Apply Alembic migrations
make etl-migrate

# Run ETL unit tests
make etl-test

# Run full integration tests (OCR + ChromaDB)
make test-priority2
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl

```bash
# Upload single PDF
curl -X POST -F "file=@test_files/scan1.pdf" http://localhost:7011/etl/upload

# Upload ZIP with multiple PDFs
curl -X POST -F "file=@test_files/scan_bundle.zip" http://localhost:7011/etl/upload

# Search in ChromaDB
curl -X POST http://localhost:7011/search \
  -H "Content-Type: application/json" \
  -d '{"query": "–∏—Å–∫", "collection": "etl_documents", "top_k": 3}'
```

### –ú–µ—Ç—Ä–∏–∫–∏ Sprint 2

- ‚úÖ **Alembic –º–∏–≥—Ä–∞—Ü–∏–∏**: 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
- ‚úÖ **E2E —Ç–µ—Å—Ç—ã**: >80% –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ **–ü–æ–∏—Å–∫**: —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å >85%

______________________________________________________________________

## üîÑ End-to-End Workflow (Sprint 3)

–í Sprint 3 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π workflow –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ—Ç–æ–≤ –∏–∑ Goszakup API –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ª–æ—Ç—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ OCR, –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤ ChromaDB –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏ –≤ Telegram.

### –°—Ö–µ–º–∞ E2E Workflow

```mermaid
flowchart TD
    A[üïê Schedule Trigger<br/>Hourly, weekdays] --> B[üì• Goszakup API<br/>Fetch lots]
    B --> C[üîç Keyword Filter<br/>–ª–∞–∫, –∫—Ä–∞—Å–∫–∞, –ø–æ–∫—Ä—ã—Ç–∏–µ]
    C --> D[‚¨áÔ∏è ETL Service<br/>Download & OCR]
    D --> E[üìä ChromaDB<br/>Index documents]
    E --> F[üîé Search Results<br/>Semantic matching]
    F --> G[üì± Telegram Bot<br/>Notifications]

    D --> H[(PostgreSQL<br/>etl_documents)]
    E --> I[(ChromaDB<br/>etl_documents)]

    style A fill:#e1f5fe
    style G fill:#c8e6c9
    style H fill:#fff3e0
    style I fill:#f3e5f5
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Workflow

#### 1. n8n Workflow Automation

```bash
# –ó–∞–ø—É—Å–∫ n8n —Å–µ—Ä–≤–∏—Å–∞
make n8n-up

# –ò–º–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤–æ–≥–æ workflow
# n8n UI: http://localhost:5678
# Import: n8n/workflows/goszakup-etl-workflow.json
```

**Workflow –≤–∫–ª—é—á–∞–µ—Ç:**

- **Schedule Trigger** - –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π —á–∞—Å –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
- **HTTP Request** - –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–æ—Ç–æ–≤ –∏–∑ Goszakup API
- **Function Filter** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º ['–ª–∞–∫', '–∫—Ä–∞—Å–∫–∞', '–ø–æ–∫—Ä—ã—Ç–∏–µ', '–º–∞—Ç–µ—Ä–∏–∞–ª', '—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ']
- **ETL Upload** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ /etl/upload-url –¥–ª—è OCR –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **ChromaDB Search** - –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Telegram Notification** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 2. ETL Service Extensions

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/etl/upload-url` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ URL:

```bash
# –ü—Ä–∏–º–µ—Ä URL upload
curl -X POST http://localhost:7011/etl/upload-url \
  -H "Content-Type: application/json" \
  -d '{
    "file_url": "https://goszakup.gov.kz/files/lot_123.pdf",
    "file_name": "specification.pdf",
    "lot_id": "LOT_123"
  }'
```

#### 3. Keyword-Based Filtering

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ª–æ—Ç—ã –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:

- **–ª–∞–∫** - –ª–∞–∫–æ–≤—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è, –ª–∞–∫–∏—Ä–æ–≤–∫–∞
- **–∫—Ä–∞—Å–∫–∞** - –∫—Ä–∞—Å–∫–∏, –ø–æ–∫—Ä–∞—Å–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
- **–ø–æ–∫—Ä—ã—Ç–∏–µ** - –∑–∞—â–∏—Ç–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è, –æ—Ç–¥–µ–ª–∫–∞
- **–º–∞—Ç–µ—Ä–∏–∞–ª** - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- **—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ** - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

#### 4. Telegram Notifications

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
üîç –ù–∞–π–¥–µ–Ω —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç

üìÑ –õ–æ—Ç: –ü–æ—Å—Ç–∞–≤–∫–∞ –ª–∞–∫–æ–≤—ã—Ö –ø–æ–∫—Ä—ã—Ç–∏–π
üÜî ID: LOT_12345
üí∞ –°—É–º–º–∞: 1 500 000 ‚Ç∏

üìã –î–æ–∫—É–º–µ–Ω—Ç: specification.pdf
‚≠ê –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 87%

üìù –§—Ä–∞–≥–º–µ–Ω—Ç: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∞–∫–æ–≤—ã—Ö...

üîó –°—Å—ã–ª–∫–∞: https://goszakup.gov.kz/lot/12345
üè∑Ô∏è –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: –ª–∞–∫, –ø–æ–∫—Ä—ã—Ç–∏–µ
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ E2E Workflow

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–ª–Ω—ã–π E2E —Ç–µ—Å—Ç (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã + workflow)
make test-priority3

# –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
bash services/etl-service/test_e2e_workflow.sh
bash services/etl-service/test_etl_upload.sh
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

- ‚úÖ **Keyword Filtering**: 100% —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **URL Download**: —É—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ PDF —Ñ–∞–π–ª–æ–≤ –ø–æ URL
- ‚úÖ **OCR Processing**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ **ChromaDB Indexing**: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ **Search Relevance**: —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ >85%
- ‚úÖ **E2E Performance**: –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª \<10 –º–∏–Ω—É—Ç (SLA)
- ‚úÖ **Telegram Integration**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **Fail-soft Behavior**: –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### CI/CD Integration

–î–æ–±–∞–≤–ª–µ–Ω `priority3-integration` job –≤ GitHub Actions:

```yaml
# –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
# –í—ã–ø–æ–ª–Ω—è–µ—Ç E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å workflow
# –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### Performance Metrics

- **Keyword Filtering**: \<1 —Å–µ–∫—É–Ω–¥–∞ –Ω–∞ 100 –ª–æ—Ç–æ–≤
- **File Download**: 2-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ PDF —Ñ–∞–π–ª
- **OCR Processing**: 5-15 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- **ChromaDB Indexing**: 1-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
- **Search Query**: \<500ms –¥–ª—è top-5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **Telegram Delivery**: \<2 —Å–µ–∫—É–Ω–¥—ã

### Monitoring & Alerting

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ workflow
curl http://localhost:5678/api/v1/workflows

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ETL service
curl http://localhost:7011/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ ChromaDB
curl http://localhost:8010/api/v1/heartbeat

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Web UI
curl http://localhost:8082/health

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f n8n etl-service web-ui
```

______________________________________________________________________

## üóÑ –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

ZakupAI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ.

### –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
make mig-revision SERVICE=billing-service m="add user table"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make mig-upgrade SERVICE=billing-service

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
make mig-downgrade SERVICE=billing-service r="-1"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL (dry-run)
make mig-sql SERVICE=billing-service
```

### Production deployment

**‚ö†Ô∏è –í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ dry-run –ø–µ—Ä–µ–¥ production:**

```bash
# 1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
make mig-sql SERVICE=billing-service > migration.sql

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL –≤—Ä—É—á–Ω—É—é
cat migration.sql

# 3. –°–æ–∑–¥–∞—Ç—å backup –ë–î –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make mig-upgrade SERVICE=billing-service
```

### Migration runners

–í Stage6 –¥–æ—Å—Ç—É–ø–Ω—ã migration-runner —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ –¥–µ–ø–ª–æ–µ:

- `migration-runner-billing`
- `migration-runner-calc`
- `migration-runner-doc`
- `migration-runner-embedding`
- `migration-runner-etl`
- `migration-runner-risk`

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

- –í—Å–µ runners –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π `Dockerfile.migration` —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –ö–æ–¥ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ volume mount –≤ `/app`
- DATABASE_URL –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å fallback

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
# –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π Stage6
./stage6-migrations.sh
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ü–∏–∫–ª: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí dry-run preview ‚Üí –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [MIGRATIONS.md](MIGRATIONS.md)

______________________________________________________________________

## üñ• Web UI Integration (Sprint 3)

–í Sprint 3 –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Web UI —Å Goszakup API, ETL —Å–µ—Ä–≤–∏—Å–æ–º –∏ ChromaDB –ø–æ–∏—Å–∫–æ–º. Web UI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ—Ç–∞–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Web UI

#### üîç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Goszakup API

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ª–æ—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Goszakup API
curl -s http://localhost:8082/lots | jq '.'
```

Web UI –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ Goszakup API –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `GOSZAKUP_TOKEN`. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–µ 5 –ª–æ—Ç–æ–≤ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ.

#### üìÑ –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ ETL –æ–ø–µ—Ä–∞—Ü–∏–π

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ Web UI ‚Üí ETL Service
curl -X POST http://localhost:8082/etl/upload \
  -F "file=@test_document.pdf"

# –ü–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Web UI ‚Üí ETL Service ‚Üí ChromaDB
curl -X POST http://localhost:8082/search \
  -H "Content-Type: application/json" \
  -d '{"query": "–ª–∞–∫–æ–≤—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è", "top_k": 5, "collection": "etl_documents"}'
```

#### üé® HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** (http://localhost:8082) - –ø–æ–∏—Å–∫ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ—Ç–∞** (http://localhost:8082/lot/{id}) - –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ—Ç–∞
- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤** (http://localhost:8082/upload) - –º–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV/XLSX
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–ª–æ–∂–µ–Ω–∏–π** (http://localhost:8082/attachments) - OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```mermaid
flowchart LR
    U[üë§ User Browser] --> W[üñ• Web UI :8082]
    W --> G[üåê Goszakup API]
    W --> E[‚ö° ETL Service :7011]
    W --> GW[üö™ API Gateway :8080]

    E --> DB[(PostgreSQL)]
    E --> CB[(ChromaDB)]

    style W fill:#e3f2fd
    style G fill:#fff3e0
    style E fill:#e8f5e8
```

### –ó–∞–ø—É—Å–∫ Web UI

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–∫–ª—é—á–∞—è Web UI
docker compose up -d web-ui

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps web-ui
curl http://localhost:8082/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Goszakup API
curl -s http://localhost:8082/lots | jq '.lots[0].nameRu'
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

Web UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env`:

```bash
# Goszakup API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
GOSZAKUP_TOKEN=your_api_token_here
GOSZAKUP_BASE=https://ows.goszakup.gov.kz

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
GATEWAY_URL=http://gateway
ZAKUPAI_API_KEY=changeme
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CI/CD

–î–æ–±–∞–≤–ª–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π `web-ui-integration` job –≤ GitHub Actions:

- –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Web UI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/health`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Goszakup API —á–µ—Ä–µ–∑ `/lots`
- –í–∞–ª–∏–¥–∞—Ü–∏—è JSON –æ—Ç–≤–µ—Ç–æ–≤

### Fail-Safe –ø–æ–≤–µ–¥–µ–Ω–∏–µ

Web UI —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º:

- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (30-60 —Å–µ–∫—É–Ω–¥)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API
- Graceful –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

______________________________________________________________________

## üß™ E2E Web UI Testing

–í Sprint 3 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Web UI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞: **Web UI ‚Üí goszakup-api ‚Üí etl-service ‚Üí ChromaDB**.

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Web UI
make webui-test

# Smoke-—Ç–µ—Å—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ curl
bash web/test_e2e_webui.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
curl -s http://localhost:8082/health
curl -s "http://localhost:8082/lots?keyword=–ª–∞–∫&limit=2"
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–æ–≤

**pytest —Ç–µ—Å—Ç—ã (web/test_e2e_webui.py):**

- ‚úÖ `GET /health` ‚Üí `{"status": "ok"}`
- ‚úÖ `GET /lots?keyword=–ª–∞–∫&limit=2` ‚Üí JSON —Å lots (>0, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ `POST /etl/upload` ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ `scan1.pdf` ‚Üí JSON —Å `content_preview`
- ‚úÖ `POST /search/documents` ‚Üí –ø–æ–∏—Å–∫ "–∏—Å–∫" ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (‚â•1)
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω: –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –ø–æ–∏—Å–∫

**bash —Ç–µ—Å—Ç—ã (web/test_e2e_webui.sh):**

- üîç Smoke-—Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ curl –∏ jq
- ‚úÖ/‚ùå –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
- üìä –ú–µ—Ç—Ä–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ—Ç–æ–≤, —Ä–∞–∑–º–µ—Ä preview, –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- `/health` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ 100% —Å–ª—É—á–∞–µ–≤
- `/lots?keyword=–ª–∞–∫` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç >0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π
- `/etl/upload` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `content_preview` –¥–ª–∏–Ω–æ–π >0
- `/search/documents` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ‚â•1 –¥–æ–∫—É–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π "–∏—Å–∫"
- CI job –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ (exit code 0)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD

–î–æ–±–∞–≤–ª–µ–Ω `webui-e2e-test` job –≤ GitHub Actions:

- –ü–æ–¥–Ω–∏–º–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫: db, goszakup-api, etl-service, chromadb, web-ui
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç jq –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–∏–∫—Å—Ç—É—Ä—É `scan1.pdf` —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ó–∞–ø—É—Å–∫–∞–µ—Ç `make webui-test`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: test_results.xml, –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Å `docker-compose down`

### –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞

–°–æ–∑–¥–∞–Ω–∞ `web/test_fixtures/scan1.pdf` —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

- "–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è OCR"
- "–°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Å–∫–µ –æ –∑–∞–∫—É–ø–∫–µ –ª–∞–∫–∞"
- "–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É '–∏—Å–∫'"

–§–∏–∫—Å—Ç—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ CI –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

______________________________________________________________________

## üèó –ò—Ç–æ–≥–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

ZakupAI ‚Äî —ç—Ç–æ –≥–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

- –ë—ç–∫–µ–Ω–¥ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤
- **üÜï –ü–æ–ª–Ω—ã–π E2E workflow** —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ—Ç–æ–≤
- **üÜï n8n Integration** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- **üÜï OCR Pipeline** —Å ChromaDB —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º
- **üÜï URL-based Processing** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Goszakup API
- **üÜï E2E Web UI Testing** —Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º –ø–∞–π–ø–ª–∞–π–Ω–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ n8n –∏ Flowise
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (Telegram Bot, Web UI)
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Billing Service (MVP)
- AI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Ollama –∏ Embedding API
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ç–∫–∞–ø—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
