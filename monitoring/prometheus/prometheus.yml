global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - /etc/prometheus/alerts.yml
  - /etc/prometheus/rules.yml

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ['prometheus:9090']

  # ZakupAI microservices (FastAPI /metrics)
  - job_name: calc-service
    metrics_path: /metrics
    static_configs:
      - targets: ['calc-service:8000']
    relabel_configs:
      - target_label: service
        replacement: calc

  - job_name: risk-engine
    metrics_path: /metrics
    static_configs:
      - targets: ['risk-engine:8000']
    relabel_configs:
      - target_label: service
        replacement: risk

  - job_name: embedding-api
    metrics_path: /metrics
    static_configs:
      - targets: ['embedding-api:8000']
    relabel_configs:
      - target_label: service
        replacement: embedding

  - job_name: etl-service
    metrics_path: /metrics
    static_configs:
      - targets: ['etl-service:8000']
    relabel_configs:
      - target_label: service
        replacement: etl

  # Vault metrics (requires authentication)
  - job_name: vault
    metrics_path: /v1/sys/metrics
    params:
      format: ['prometheus']
    scheme: http
    scrape_interval: 30s
    static_configs:
      - targets: ['vault:8200']
    authorization:
      type: Bearer
      # Token file mounted from monitoring/vault/creds/monitoring.token
      credentials_file: /etc/prometheus/vault-metrics.token
    relabel_configs:
      - target_label: service
        replacement: vault
  - job_name: "vault_metrics"
    scheme: http
    static_configs:
      - targets: ["vault-metrics-proxy:9102"]
        labels:
          service: "vault"
    metrics_path: /vault_metrics.prom
    scrape_interval: 30s
  - job_name: node-exporter
    static_configs:
      - targets: ['node-exporter:9100']
  - job_name: cadvisor
    static_configs:
      - targets: ['cadvisor:8080']
  - job_name: redis-exporter
    static_configs:
      - targets: ['redis-exporter:9121']
  - job_name: postgres-exporter
    static_configs:
      - targets: ['postgres-exporter:9187']
